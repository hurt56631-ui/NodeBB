(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,52185,74566,92332,99127],{12236:((v,h,s)=>{"use strict";var g,E;g=[s(49897),s(29930)],E=(function(y,b){const a={};a.init=function(n,t){const i=n.find(".draft-icon"),e=n.attr("data-uuid");function r(){$(`[component="composer"][data-uuid="${e}"]`).length&&(t.save_id||(t.save_id=utils.generateSaveId(app.user.uid)),a.addToDraftList("available",t.save_id),a.addToDraftList("open",t.save_id),O(n,i,t))}n.on("keyup","textarea, input.handle, input.title",utils.debounce(r,1e3)),n.on("click",'input[type="checkbox"]',utils.debounce(r,1e3)),n.on("click",'[component="category/list"] [data-cid]',utils.debounce(r,1e3)),n.on("itemAdded",".tags",utils.debounce(r,1e3)),n.on("thumb.uploaded",r),i.on("animationend",function(){$(this).toggleClass("active",!1)}),$(window).on("unload",function(){const o=a.getList("open");o.length&&o.forEach(u=>a.removeFromDraftList("open",u))}),a.migrateGuest()};function d(n){return parseInt(n,10)>0?localStorage:sessionStorage}a.get=function(n){if(!n)return null;const t=n.split(":")[1],i=d(t);try{const e=i.getItem(n),r=JSON.parse(e)||null;if(!r)throw new Error(`can't parse draft json for ${n}`);return r.save_id=n,r.timestamp&&(r.timestampISO=utils.toISOString(r.timestamp)),$(window).trigger("action:composer.drafts.get",{save_id:n,draft:r,storage:i}),r}catch{return console.warn(`[composer/drafts] Could not get draft ${n}, removing`),a.removeFromDraftList("available"),a.removeFromDraftList("open"),null}};function O(n,t,i){if(m(app.user.uid?"localStorage":"sessionStorage")&&i&&i.save_id&&n.length){const e=n.find("input.title"),r=e&&e.length&&e.val(),o=n.find("textarea").val(),u=d(app.user.uid);if(o.length||r&&r.length){const l={save_id:i.save_id,action:i.action,text:o,uuid:n.attr("data-uuid"),timestamp:Date.now()};if(i.action==="topics.post"){const p=n.find("input.tags").val();l.tags=p,l.title=r,l.cid=i.cid,l.thumbs=i.thumbs||[]}else i.action==="posts.reply"?(l.title=i.title,l.tid=i.tid,l.toPid=i.toPid):i.action==="posts.edit"&&(l.pid=i.pid,l.title=r||i.title,l.thumbs=i.thumbs||[]);app.user.uid||(l.handle=n.find("input.handle").val()),u.setItem(i.save_id,JSON.stringify(l)),$(window).trigger("action:composer.drafts.save",{storage:u,postData:i,postContainer:n}),t.toggleClass("active",!0)}else a.removeDraft(i.save_id)}}a.removeDraft=function(n){if(!n)return;a.removeFromDraftList("available",n),a.removeFromDraftList("open",n);const t=n.split(":")[1],i=d(t);i.removeItem(n),$(window).trigger("action:composer.drafts.remove",{storage:i,save_id:n})},a.getList=function(n){try{const t=localStorage.getItem(`drafts:${n}`);return JSON.parse(t)||[]}catch{return console.warn("[composer/drafts] Could not read list of available drafts"),[]}},a.addToDraftList=function(n,t){if(!m(app.user.uid?"localStorage":"sessionStorage")||!t)return;const i=a.getList(n);i.includes(t)||(i.push(t),localStorage.setItem("drafts:"+n,JSON.stringify(i)))},a.removeFromDraftList=function(n,t){if(!m(app.user.uid?"localStorage":"sessionStorage")||!t)return;const i=a.getList(n);i.includes(t)&&(i.splice(i.indexOf(t),1),localStorage.setItem("drafts:"+n,JSON.stringify(i)))},a.migrateGuest=function(){if(m("localStorage")&&app.user.uid){const n=/^composer:\d+:\d$/,t=Object.keys(sessionStorage).filter(function(r){return n.test(r)}),i=new Set([]),e=t.map(function(r){const o=r.split(":");return o[1]=app.user.uid,i.add(o.join(":")),o.join(":")});return t.forEach(function(r,o){localStorage.setItem(e[o],sessionStorage.getItem(r)),sessionStorage.removeItem(r)}),i.forEach(function(r){a.addToDraftList("available",r)}),i}},a.listAvailable=function(){return a.getList("available").map(a.get).filter(Boolean)},a.getAvailableCount=function(){return a.listAvailable().length},a.open=function(n){if(!n)return;const t=a.get(n);S(n,t)},a.loadOpen=function(){if(ajaxify.data.template.login||ajaxify.data.template.register||config.hasOwnProperty("openDraftsOnPageLoad")&&!config.openDraftsOnPageLoad)return;const n=a.getList("available"),t=a.getList("open");n.length&&n.forEach(function(i){if(!i||t.includes(i))return;const e=a.get(i);if(!e||!e.text&&!e.title){a.removeFromDraftList("available",i),a.removeFromDraftList("open",i);return}S(i,e)})};function S(n,t){const e=n.split(":")[1];parseInt(app.user.uid,10)===parseInt(e,10)&&Promise.all([s.e(20056),s.e(23662),s.e(65285),s.e(40559),s.e(449),s.e(5785),s.e(58540)]).then(function(){var r=[s(71431)];(function(o){t.action==="topics.post"?o.newTopic({save_id:t.save_id,cid:t.cid,handle:app.user&&app.user.uid?void 0:utils.escapeHTML(t.handle),title:utils.escapeHTML(t.title),body:t.text,tags:String(t.tags||"").split(","),thumbs:t.thumbs||[]}):t.action==="posts.reply"?y.get("/topics/"+t.tid,{},function(u,l){if(u)return b.error(u);o.newReply({save_id:t.save_id,tid:t.tid,toPid:t.toPid,title:l.title,body:t.text})}):t.action==="posts.edit"&&o.editPost({save_id:t.save_id,pid:t.pid,title:t.title?utils.escapeHTML(t.title):void 0,body:t.text,thumbs:t.thumbs||[]})}).apply(null,r)}).catch(s.oe)}function m(n){var t;try{t=window[n];var i="__storage_test__";return t.setItem(i,i),t.removeItem(i),!0}catch(e){return e instanceof DOMException&&(e.code===22||e.code===1014||e.name==="QuotaExceededError"||e.name==="NS_ERROR_DOM_QUOTA_REACHED")&&t&&t.length!==0}}return a}).apply(h,g),E!==void 0&&(v.exports=E)}),49897:((v,h,s)=>{"use strict";s.r(h),s.d(h,{del:()=>i,get:()=>O,head:()=>S,patch:()=>n,post:()=>m,put:()=>t});var g=s(91749),E=s.n(g),y=s(33530),b=s.n(y);const a=config.relative_path+"/api/v3";async function f(e,r){if(e.url=e.url.startsWith("/api")?config.relative_path+e.url:a+e.url,typeof r=="function"){d(e).then(o=>r(null,o),o=>r(o));return}try{return await d(e)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:u}=await(0,g.fire)("filter:admin.reauth",{url:"login"});return(0,y.confirm)("[[error:api.reauth-required]]",l=>{l&&ajaxify.go(u)})}throw o}}async function d(e){const{url:r}=e;delete e.url,e.data&&!(e.data instanceof FormData)&&(e.data=JSON.stringify(e.data||{}),e.headers["content-type"]="application/json; charset=utf-8"),{options:e}=await(0,g.fire)("filter:api.options",{options:e}),e.data&&(e.body=e.data,delete e.data);const o=await fetch(r,e),{headers:u}=o;if(u.get("x-redirect"))return d({url:u.get("x-redirect"),...e});const l=u.get("content-type"),p=l&&l.startsWith("application/json");let c;if(e.method!=="HEAD"&&(p?c=await o.json():c=await o.text()),!o.ok)throw c?new Error(p?c.status.message:c):new Error(o.statusText);return p&&c&&c.hasOwnProperty("status")&&c.hasOwnProperty("response")?c.response:c}function O(e,r,o){return f({url:e+(r&&Object.keys(r).length?"?"+$.param(r):"")},o)}function S(e,r,o){return f({url:e+(r&&Object.keys(r).length?"?"+$.param(r):""),method:"HEAD"},o)}function m(e,r,o){return f({url:e,method:"POST",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function n(e,r,o){return f({url:e,method:"PATCH",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function t(e,r,o){return f({url:e,method:"PUT",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}function i(e,r,o){return f({url:e,method:"DELETE",data:r,headers:{"x-csrf-token":config.csrf_token}},o)}}),74566:((v,h,s)=>{v.exports=s(12236)})}]);
