"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,36159,49897,58540,62441,88189,98463,99127],{24187:((D,A,a)=>{var m,p;m=[a(64061)],p=(function(){const c={};c.show=function(e,s){const o=e.hasOwnProperty("fileSize")&&e.fileSize!==void 0?parseInt(e.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:e.hasOwnProperty("showHelp")&&e.showHelp!==void 0?e.showHelp:!0,fileSize:o,title:e.title||"[[global:upload-file]]",description:e.description||"",button:e.button||"[[global:upload]]",accept:e.accept?e.accept.replace(/,/g,"&#44; "):""},function(n){n.modal("show"),n.on("hidden.bs.modal",function(){n.remove()});const l=n.find("#uploadForm");l.attr("action",e.route),l.find("#params").val(JSON.stringify(e.params)),n.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),l.submit()}),l.submit(function(){return P(n,o,s),!1})})},c.hideAlerts=function(e){$(e).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function P(e,s,o){g(e,"status","[[uploads:uploading-file]]"),e.find("#upload-progress-bar").css("width","0%"),e.find("#upload-progress-box").show().removeClass("hide");const n=e.find("#fileInput");if(!n.val())return g(e,"error","[[uploads:select-file-to-upload]]");if(!b(n[0],s))return g(e,"error","[[error:file-too-big, "+s+"]]");c.ajaxSubmit(e,o)}function g(e,s,o){c.hideAlerts(e),s==="error"&&e.find("#fileUploadSubmitBtn").removeClass("disabled"),o=o.replace(/&amp;#44/g,"&#44"),e.find("#alert-"+s).translateText(o).removeClass("hide")}c.ajaxSubmit=function(e,s){e.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(n){n=d(n),g(e,"error",n.responseJSON?.status?.message||n.responseJSON?.error||`[[error:upload-error-fallback, ${n.status} ${n.statusText}]]`)},uploadProgress:function(n,l,u,t){e.find("#upload-progress-bar").css("width",t+"%")},success:function(n){let l=d(n);n.hasOwnProperty("response")&&n.hasOwnProperty("status")&&n.status.code==="ok"&&(l=n.response.images),s(l[0].url),g(e,"success","[[uploads:upload-success]]"),setTimeout(function(){c.hideAlerts(e),e.modal("hide")},750)}})};function d(e){if(typeof e=="string")try{return JSON.parse(e)}catch(s){return console.error(s),{error:"[[error:parse-error]]"}}return e}function b(e,s){return window.FileReader&&s?e.files[0].size<=s*1e3:!0}return c}).apply(A,m),p!==void 0&&(D.exports=p)}),36159:((D,A,a)=>{var m,p;m=[a(49897),a(33530),a(29930),a(24187),a(81335),a(17459),a(65285)],p=(function(c,P,g,d,b,e){const s={};return s.get=o=>c.get(`/topics/${o}/thumbs`,{thumbsOnly:1}),s.delete=(o,n)=>c.del(`/topics/${o}/thumbs`,{path:n}),s.updateTopicThumbs=async o=>{const n=await s.get(o),l=await app.parseAndTranslate("partials/topic/thumbs",{thumbs:n});$('[component="topic/thumb/list"]').html(l)},s.deleteAll=o=>{s.get(o).then(n=>{Promise.all(n.map(l=>s.delete(o,l.url)))})},s.upload=()=>new Promise(o=>{d.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+"/api/topic/thumb/upload"},function(n){o(n)})}),s.modal={},s.modal.open=function(o){const{id:n,postData:l}=o;let{modal:u}=o;const t=l.thumbs||[];return new Promise(i=>{b.render("modals/topic-thumbs",{thumbs:t}).then(r=>{u?e.translate(r,function(f){u.find(".bootbox-body").html(f),s.modal.handleSort({modal:u,thumbs:t})}):(u=P.dialog({title:"[[modules:thumbs.modal.title]]",message:r,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(s.upload().then(f=>{l.thumbs.push(f.replace(new RegExp(`^${config.upload_url}`),"")),s.modal.open({...o,modal:u}),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var E=[a(71431)];(y=>{y.updateThumbCount(n,$(`[component="composer"][data-uuid="${n}"]`)),i()}).apply(null,E)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),s.modal.handleDelete({...o,modal:u}),s.modal.handleSort({modal:u,thumbs:t}))})})},s.modal.handleDelete=o=>{const n=o.modal.get(0),{id:l}=o;n.addEventListener("click",u=>{u.target.closest('button[data-action="remove"]')&&P.confirm("[[modules:thumbs.modal.confirm-remove]]",t=>{if(!t)return;const i=u.target.closest("[data-path]").getAttribute("data-path"),r=o.postData;r&&r.thumbs&&r.thumbs.includes(i)&&(r.thumbs=r.thumbs.filter(f=>f!==i),s.modal.open(o),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var f=[a(71431)];(E=>{E.updateThumbCount(l,$(`[component="composer"][data-uuid="${l}"]`))}).apply(null,f)}).catch(a.oe))})})},s.modal.handleSort=({modal:o,thumbs:n})=>{if(n.length>1){const l=o.find(".topic-thumbs-modal");l.sortable({items:"[data-path]"}),l.on("sortupdate",function(){if(!n)return;const u=[];l.find("[data-path]").each(function(){const t=$(this).attr("data-path"),i=n.find(r=>r===t);i&&u.push(i)}),n.length=0,Array.prototype.push.apply(n,u)})}},s}).apply(A,m),p!==void 0&&(D.exports=p)}),49897:((D,A,a)=>{a.r(A),a.d(A,{del:()=>u,get:()=>e,head:()=>s,patch:()=>n,post:()=>o,put:()=>l});var m=a(91749),p=a.n(m),c=a(33530),P=a.n(c);const g=config.relative_path+"/api/v3";async function d(t,i){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:g+t.url,typeof i=="function"){b(t).then(r=>i(null,r),r=>i(r));return}try{return await b(t)}catch(r){if(r.message==="A valid login session was not found. Please log in and try again."){const{url:f}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,c.confirm)("[[error:api.reauth-required]]",E=>{E&&ajaxify.go(f)})}throw r}}async function b(t){const{url:i}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,m.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const r=await fetch(i,t),{headers:f}=r;if(f.get("x-redirect"))return b({url:f.get("x-redirect"),...t});const E=f.get("content-type"),y=E&&E.startsWith("application/json");let h;if(t.method!=="HEAD"&&(y?h=await r.json():h=await r.text()),!r.ok)throw h?new Error(y?h.status.message:h):new Error(r.statusText);return y&&h&&h.hasOwnProperty("status")&&h.hasOwnProperty("response")?h.response:h}function e(t,i,r){return d({url:t+(i&&Object.keys(i).length?"?"+$.param(i):"")},r)}function s(t,i,r){return d({url:t+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},r)}function o(t,i,r){return d({url:t,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function n(t,i,r){return d({url:t,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function l(t,i,r){return d({url:t,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}function u(t,i,r){return d({url:t,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},r)}})}]);
