"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8981,14526,42619,90954],{25955:((F,B,l)=>{var L,x;L=[l(91749),l(29930),l(89336)],x=(function(T,D,g){const E={};E.init=function(n,i){if(!n||!n.length)return;i=i||{},i.template="partials/tags/filter-dropdown-left",T.fire("action:tag.filter.options",{el:n,options:i});const o=n.find('[component="tag/filter/search"]');i.selectedTags=i.selectedTags||ajaxify.data.selectedTags||[];let d=null,t=[],r=[];Array.isArray(i.selectedTags)?t=i.selectedTags.map(String):Array.isArray(ajaxify.data.selectedTags)&&(t=ajaxify.data.selectedTags.map(String)),r=t.slice();const y=o.parents('[component="tag/filter"]').length&&app.user.privileges["search:tags"];n.on("show.bs.dropdown",function(){y&&o.removeClass("hidden");function p(){const h=o.find("input").val();h.length>1||!h&&!d?s(h,function(C){d=d||C,m(C)}):!h&&d&&m(d)}o.on("click",function(h){h.preventDefault(),h.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(p,300)),p()}),n.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),n.on("hidden.bs.dropdown",function(){y&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup");let p=r.length!==t.length;if(r.forEach(function(h,C){h!==t[C]&&(p=!0)}),r=t.slice(),p&&(i.updateButton?i.updateButton({el:n,changed:p,selectedTags:t.slice()}):i.updateButton!==!1&&w(n,t)),i.onHidden){i.onHidden({changed:p,selectedTags:t.slice()});return}if(p){let h=window.location.pathname;const C=utils.params();t.length?C.tag=t.length?t:void 0:delete C.tag,delete C.page,Object.keys(C).length&&(h+="?"+$.param(C)),ajaxify.go(h)}}),n.on("click",'[component="tag/filter/list"] [data-tag]',function(){const p=n.find('[component="tag/filter/list"]'),h=$(this),C=h.find("a").attr("href");if(C&&C!=="#"&&C.length)return;const P=h.attr("data-tag"),M=h.find('[component="tag/select/icon"]');return P!==""?(t.includes(P)?t.splice(t.indexOf(P),1):t.push(P),t.sort(function(R,b){return R-b}),M.toggleClass("invisible")):(n.find('[component="tag/select/icon"]').addClass("invisible"),t=[]),p.find('[data-tag=""] i').toggleClass("invisible",!!t.length),i.selectedTags=t,i.onSelect&&i.onSelect({tag:P,selectedTags:t.slice()}),!1});function s(p,h){let C=null;ajaxify.data.template.category||ajaxify.data.template.world?C=[ajaxify.data.cid]:Array.isArray(ajaxify.data.selectedCids)&&ajaxify.data.selectedCids.length&&(C=ajaxify.data.selectedCids),socket.emit("topics.tagFilterSearch",{query:p,cids:C},function(P,M){if(P)return D.error(P);h(M)})}function m(p){const h=i.selectedTags;p.forEach(function(C){C.selected=h.includes(C.value)}),app.parseAndTranslate(i.template,{tagItems:p.slice(0,200),selectedTag:ajaxify.data.selectedTag},function(C){n.find('[component="tag/filter/list"]').html(C.find('[component="tag/filter/list"]').html());const P=g.Dropdown.getInstance(n.find(".dropdown-toggle").get(0));P&&P.update()})}};function w(n,i){i.length>0?o({label:i.join(", ")}):o();function o(d){app.parseAndTranslate("partials/tags/filter-dropdown-content",{selectedTag:d},function(t){n.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return E}).apply(B,L),x!==void 0&&(F.exports=x)}),39259:((F,B,l)=>{var L,x;L=[l(96349),l(49897),l(91749)],x=(function(T,D,g){const E={};E.init=function(n,i){if(!n||!n.length)return;i=i||{},i.states=i.states||["watching","tracking","notwatching","ignoring"],i.template=i.template||"partials/category/filter-dropdown-left",g.fire("action:category.filter.options",{el:n,options:i}),T.init(n,i);let o=[],d=[];Array.isArray(i.selectedCids)?o=i.selectedCids.map(String):Array.isArray(ajaxify.data.selectedCids)&&(o=ajaxify.data.selectedCids.map(String)),d=o.slice(),n.on("hidden.bs.dropdown",function(){let t=d.length!==o.length;if(d.forEach(function(r,y){r!==o[y]&&(t=!0)}),d=o.slice(),t&&(i.updateButton?i.updateButton({el:n,changed:t,selectedCids:o.slice()}):i.updateButton!==!1&&w(n,o)),i.onHidden){i.onHidden({changed:t,selectedCids:o.slice()});return}if(t){let r=window.location.pathname;const y=utils.params();o.length?y.cid=o:delete y.cid,delete y.page,Object.keys(y).length&&(r+="?"+$.param(y)),ajaxify.go(r)}}),n.on("click",'[component="category/list"] [data-cid]',function(t){const r=n.find('[component="category/list"]'),y=$(this),s=y.find("a").attr("href");if(s&&s!=="#"&&s.length){t.stopPropagation();return}const m=y.attr("data-cid"),p=y.find('[component="category/select/icon"]');return m!=="all"?(o.includes(m)?o.splice(o.indexOf(m),1):o.push(m),o.sort(function(h,C){return h-C}),p.toggleClass("invisible"),r.find('[data-cid="all"] i').toggleClass("invisible",!!o.length)):(n.find('[component="category/select/icon"]').addClass("invisible"),r.find('[data-cid="all"] i').removeClass("invisible"),o=[]),i.selectedCids=o,i.onSelect&&i.onSelect({cid:m,selectedCids:o.slice()}),!1})};function w(n,i){i.length>1?o({icon:"fa-plus",name:"[[unread:multiple-categories-selected]]",bgColor:"#ddd"}):i.length===1?D.get(`/categories/${i[0]}`,{}).then(o):o();function o(d){app.parseAndTranslate("partials/category/filter-dropdown-content",{selectedCategory:d},function(t){n.find("button").replaceWith($("<div/>").html(t).find("button"))})}}return E}).apply(B,L),x!==void 0&&(F.exports=x)}),47682:((F,B,l)=>{var L,x;L=[l(22410),l(60644),l(70550),l(39259),l(25955),l(71131),l(91749)],x=(function(T,D,g,E,w,n,i){const o={};let d="",t=0,r=0,y,s;const m=[];$(window).on("action:ajaxify.start",function(){o.removeListeners(),n.removeListeners()}),o.init=function(u,f){s=p(),d=u,y=f||R,n.init(),o.watchForNewPosts();const v=["watching","tracking"];ajaxify.data.selectedFilter&&ajaxify.data.selectedFilter.filter==="watched"?v.push("notwatching","ignoring"):u!=="unread"&&v.push("notwatching"),E.init($('[component="category/dropdown"]'),{states:v}),w.init($('[component="tag/filter"]')),config.usePagination||T.init(o.loadMoreTopics),D.init(function(k,e){y(k,1,function(c,a){N(d,c,ajaxify.data.showSelect,1,function(){e(),a()})})}),$("body").height()<=$(window).height()&&s.children().length>=20&&$("#load-more-btn").show(),$("#load-more-btn").on("click",function(){o.loadMoreTopics(1)}),i.fire("action:topics.loaded",{topics:ajaxify.data.topics})};function p(){return $('[component="category"]').filter(function(u,f){return!$(f).parents("[widget-area],[data-widget-area]").length})}o.watchForNewPosts=function(){r=0,t=0,o.removeListeners(),socket.on("event:new_topic",h),socket.on("event:new_post",C)},o.removeListeners=function(){socket.removeListener("event:new_topic",h),socket.removeListener("event:new_post",C)};function h(u){const f=ajaxify.data,v=f.selectedCids&&f.selectedCids.length&&f.selectedCids.indexOf(parseInt(u.cid,10))===-1,k=f.selectedFilter&&f.selectedFilter.filter==="watched",e=f.template.category&&parseInt(f.cid,10)!==parseInt(u.cid,10),c=!!(v||k||e||m.includes(u.tid));i.fire("filter:topicList.onNewTopic",{topic:u,preventAlert:c}).then(a=>{a.preventAlert||(u.scheduled&&u.tid&&m.push(u.tid),t+=1,P())})}function C(u){const f=u.posts[0];if(!f||!f.topic||f.topic.isFollowing)return;const v=ajaxify.data,k=parseInt(f.topic.mainPid,10)===parseInt(f.pid,10),e=v.selectedCids&&v.selectedCids.length&&v.selectedCids.indexOf(parseInt(f.topic.cid,10))===-1,c=v.selectedFilter&&v.selectedFilter.filter==="new",a=v.selectedFilter&&v.selectedFilter.filter==="watched"&&!f.topic.isFollowing,A=v.template.category&&parseInt(v.cid,10)!==parseInt(f.topic.cid,10),j=!!(k||e||c||a||A);i.fire("filter:topicList.onNewPost",{post:f,preventAlert:j}).then(S=>{S.preventAlert||(r+=1,P())})}function P(){(t>0||r>0)&&($("#new-topics-alert").removeClass("hide").fadeIn("slow"),$("#category-no-topics").addClass("hide"))}o.loadMoreTopics=function(u){if(!s.length||!s.children().length)return;const f=s.find('[component="category/topic"]'),v=u>0?f.last():f.first(),k=(parseInt(v.attr("data-index"),10)||0)+(u>0?1:0);!utils.isNumber(k)||k===0&&s.find('[component="category/topic"][data-index="0"]').length||y(k,u,function(e,c){N(d,e,ajaxify.data.showSelect,u,c)})};function M(u,f){return Math.floor(u/config.topicsPerPage)+(f>0?1:0)}function R(u,f,v){v=v||function(){};const k=utils.params();k.page=M(u,f),T.loadMoreXhr(k,v)}function b(u){return u.filter(function(f){return!s.find('[component="category/topic"][data-tid="'+f.tid+'"]').length})}function N(u,f,v,k,e){let{topics:c}=f;if(!c||!c.length||(c=b(c),!c.length))return $("#load-more-btn").hide(),e();let a,A;const j=s.find('[component="category/topic"]');k>0&&c.length?a=j.last():k<0&&c.length&&(A=j.first());const S={topics:c,showSelect:v,"reputation:disabled":f["reputation:disabled"],template:{name:u,[u]:!0}};ajaxify.data.cid&&(S.cid=ajaxify.data.cid),i.fire("action:topics.loading",{topics:c,after:a,before:A}),app.parseAndTranslate(u,"topics",S,function(I){if(s.removeClass("hidden"),$("#category-no-topics").remove(),a&&a.length)I.insertAfter(a);else if(A&&A.length){const K=$(document).height(),W=$(window).scrollTop();I.insertBefore(A),$(window).scrollTop(W+($(document).height()-K))}else s.append(I);g.getSelectedTids().length||T.removeExtra(s.find('[component="category/topic"]'),k,Math.max(60,config.topicsPerPage*3)),I.find(".timeago").timeago(),i.fire("action:topics.loaded",{topics:c,template:u}),e()})}return o}).apply(B,L),x!==void 0&&(F.exports=x)}),70550:((F,B,l)=>{var L,x;L=[l(52473)],x=(function(T){const D={};let g,E;D.init=function(t){E=$('[component="category"]'),E.on("selectstart",'[component="topic/select"]',function(r){r.preventDefault()}),E.on("click",'[component="topic/select"]',function(r){const s=$(this).parents('[component="category/topic"]');if(r.shiftKey)return i(s.attr("data-tid")),g=s,!1;const m=s.hasClass("selected");w(s,!m),g=s,typeof t=="function"&&t()})};function w(t,r){const y=t.find('[component="topic/select"]');y.toggleClass("fa-check-square-o",r),y.toggleClass("fa-square-o",!r),y.parents('[component="category/topic"]').toggleClass("selected",r),n()}function n(){const t=$('[component="topic/selected/badge"]');if(t.length){const r=E.find('[component="category/topic"].selected').length;t.text(r>0?r:"")}}D.getSelectedTids=function(){const t=[];return E&&E.find('[component="category/topic"].selected').each(function(){t.push($(this).attr("data-tid"))}),t},D.unselectAll=function(){E&&(E.find('[component="category/topic"].selected').removeClass("selected"),E.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),n())};function i(t){g||(g=$('[component="category/topic"]').first());const r=T.get("category/topic","tid",t).hasClass("selected"),y=d(t),s=d(g.attr("data-tid"));o(y,s,!r)}function o(t,r,y){if(t>r){const s=t;t=r,r=s}for(let s=t;s<=r;s+=1){const m=$('[component="category/topic"]').eq(s);w(m,y)}}function d(t){return T.get("category/topic","tid",t).index('[component="category/topic"]')}return D}).apply(B,L),x!==void 0&&(F.exports=x)}),71131:((F,B,l)=>{var L,x;L=[l(70550),l(60984),l(52473),l(49897),l(33530),l(29930)],x=(function(T,D,g,E,w,n){const i={};i.init=function(){T.init(s),k(),$('[component="category/topic"]').each((e,c)=>{D.observeTopicLabels($(c).find('[component="topic/labels"]'))}),g.get("topic/delete").on("click",function(){return o("del","/state","delete",r),!1}),g.get("topic/restore").on("click",function(){return o("put","/state","restore",r),!1}),g.get("topic/purge").on("click",function(){return o("del","","purge",y),!1}),g.get("topic/lock").on("click",function(){return o("put","/lock","lock",t),!1}),g.get("topic/unlock").on("click",function(){return o("del","/lock","unlock",t),!1}),g.get("topic/pin").on("click",function(){return o("put","/pin","pin",t),!1}),g.get("topic/unpin").on("click",function(){return o("del","/pin","unpin",t),!1}),g.get("topic/mark-unread-for-all").on("click",function(){const e=T.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(c){if(c)return n.error(c);n.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(a){$('[component="category/topic"][data-tid="'+a+'"]').addClass("unread")}),t()}),!1):n.error("[[error:no-topics-selected]]")}),g.get("topic/move").on("click",function(){return l.e(28310).then(function(){var e=[l(28310)];(function(c){const a=T.getSelectedTids();if(!a.length)return n.error("[[error:no-topics-selected]]");c.init(a,null,t)}).apply(null,e)}).catch(l.oe),!1}),g.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return n.error("[[error:invalid-data]]");l.e(28310).then(function(){var c=[l(28310)];(function(a){a.init(null,e,function(A){if(A)return n.error(A);ajaxify.refresh()})}).apply(null,c)}).catch(l.oe)}),g.get("topic/merge").on("click",function(){const e=T.getSelectedTids();l.e(2403).then(function(){var c=[l(2403)];(function(a){a.init(function(){e.length&&e.forEach(function(A){a.addTopic(A)})})}).apply(null,c)}).catch(l.oe)}),g.get("topic/tag").on("click",async function(){const e=T.getSelectedTids();if(!e.length)return n.error("[[error:no-topics-selected]]");const c=await Promise.all(e.map(a=>E.get(`/topics/${a}`)));Promise.all([l.e(20056),l.e(63)]).then(function(){var a=[l(63)];(function(A){A.init(c,ajaxify.data.tagWhitelist,t)}).apply(null,a)}).catch(l.oe)}),i.removeListeners(),socket.on("event:topic_deleted",b),socket.on("event:topic_restored",b),socket.on("event:topic_purged",v),socket.on("event:topic_locked",u),socket.on("event:topic_unlocked",u),socket.on("event:topic_pinned",N),socket.on("event:topic_unpinned",N),socket.on("event:topic_moved",f)};function o(e,c,a,A){A||(A=function(){});const j=T.getSelectedTids(),S={},I=function(K){K&&Promise.all(j.map(W=>E[e](`/topics/${W}${c}`,S))).then(A).catch(n.error)};if(!j.length)return n.error("[[error:no-topics-selected]]");switch(a){case"delete":case"restore":case"purge":w.confirm(`[[topic:thread-tools.${a}-confirm]]`,I);break;case"pin":D.requestPinExpiry(S,I.bind(null,!0));break;default:I(!0);break}}i.removeListeners=function(){socket.removeListener("event:topic_deleted",b),socket.removeListener("event:topic_restored",b),socket.removeListener("event:topic_purged",v),socket.removeListener("event:topic_locked",u),socket.removeListener("event:topic_unlocked",u),socket.removeListener("event:topic_pinned",N),socket.removeListener("event:topic_unpinned",N),socket.removeListener("event:topic_moved",f)};function d(){$(".thread-tools .show").removeClass("show")}function t(){d(),T.unselectAll()}function r(){d(),s()}function y(){d(),T.unselectAll(),s()}function s(){const e=T.getSelectedTids(),c=m(h,e),a=p(h,e),A=m(P,e),j=m(C,e),S=m(M,e),I=p(M,e);g.get("topic/delete").toggleClass("hidden",c),g.get("topic/restore").toggleClass("hidden",S||!c),g.get("topic/purge").toggleClass("hidden",!a||!e.length),g.get("topic/lock").toggleClass("hidden",j),g.get("topic/unlock").toggleClass("hidden",!j),g.get("topic/pin").toggleClass("hidden",I||A),g.get("topic/unpin").toggleClass("hidden",I||!A),g.get("topic/merge").toggleClass("hidden",S)}function m(e,c){for(let a=0;a<c.length;a+=1)if(e(c[a]))return!0;return!1}function p(e,c){for(let a=0;a<c.length;a+=1)if(!e(c[a]))return!1;return!0}function h(e){return R(e).hasClass("deleted")}function C(e){return R(e).hasClass("locked")}function P(e){return R(e).hasClass("pinned")}function M(e){return R(e).hasClass("scheduled")}function R(e){return g.get("category/topic","tid",e)}function b(e){const c=R(e.tid);c.toggleClass("deleted",e.isDeleted),c.find('[component="topic/locked"]').toggleClass("hidden",!e.isDeleted)}function N(e){const c=R(e.tid);c.toggleClass("pinned",e.isPinned),c.find('[component="topic/pinned"]').toggleClass("hidden",!e.isPinned),ajaxify.refresh()}function u(e){const c=R(e.tid);c.toggleClass("locked",e.isLocked),c.find('[component="topic/locked"]').toggleClass("hidden",!e.isLocked)}async function f(e){if(ajaxify.data.template.category||String(e.toCid)==="-1")R(e.tid).remove();else{const c=await E.get(`/categories/${e.toCid}`),a=await app.parseAndTranslate("partials/topics_list",{topics:[{...e,category:c}]}),A=`[component="category/topic"][data-tid="${e.tid}"] [component="topic/category"]`;$(A).replaceWith(a.find(A))}}function v(e){R(e.tid).remove()}function k(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(c=>c.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const c=$('[component="category"]').filter(function(A,j){return!$(j).parents("[widget-area],[data-widget-area]").length});let a=0;c.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){a=parseInt(c.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(A,j){const S=j.item.attr("data-tid"),I=c.find('[component="category/topic"].pinned');let K=0;I.each((W,U)=>{if($(U).attr("data-tid")===S)return K=W,!1}),socket.emit("topics.orderPinnedTopics",{tid:S,order:a+K},function(W){if(W)return n.error(W);I.each((U,Y)=>{$(Y).attr("data-index",a+U)})})}})})}return i}).apply(B,L),x!==void 0&&(F.exports=x)}),96349:((F,B,l)=>{var L,x;L=[l(29930),l(89336),l(49897)],x=(function(T,D,g){const E={};return E.init=function(w,n){let i=n.defaultCategories||null;n=n||{},n.privilege=n.privilege||"topics:read",n.states=n.states||["watching","tracking","notwatching","ignoring"],n.cacheList=n.hasOwnProperty("cacheList")?n.cacheList:!0;let o=[];Array.isArray(n.localCategories)&&(o=n.localCategories.map(s=>({...s})),i&&(i=[...o,...i])),n.selectedCids=n.selectedCids||ajaxify.data.selectedCids||[];const d=w.find('[component="category-selector-search"]');if(!d.length)return;const t=d.parents('[component="category/dropdown"]').length>0||d.parents('[component="category-selector"]').length>0;w.on("show.bs.dropdown",function(){t&&d.removeClass("hidden");function s(){const m=d.find("input").val();m.length>1||!m&&!i?r(m,function(p){i=n.cacheList&&(i||p),y(p)}):!m&&i&&y(i)}d.on("click",function(m){m.preventDefault(),m.stopPropagation()}),d.find("input").val("").on("keyup",utils.debounce(s,300)),s()}),w.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||d.find("input").focus()}),w.on("hide.bs.dropdown",function(){t&&d.addClass("hidden"),d.off("click"),d.find("input").off("keyup")});function r(s,m){g.get("/search/categories",{search:s,query:utils.params(),parentCid:n.parentCid||0,selectedCids:n.selectedCids,privilege:n.privilege,states:n.states,showLinks:n.showLinks},function(p,{categories:h}){if(p)return T.error(p);m(o.concat(h))})}function y(s){const m=n.selectedCids.map(String);s.forEach(function(p){p.selected=m.includes(String(p.cid))}),app.parseAndTranslate(n.template,{categoryItems:s.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(p){w.find('[component="category/list"]').html(p.find('[component="category/list"]').html()),w.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!s.length);const h=D.Dropdown.getInstance(w.find(".dropdown-toggle").get(0));h&&h.update()})}},E}).apply(B,L),x!==void 0&&(F.exports=x)})}]);
