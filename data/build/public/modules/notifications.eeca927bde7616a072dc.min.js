(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[81307],{36849:((R,O,p)=>{"use strict";var b,k;b=[p(17459),p(52473),p(96352),p(40279),p(91749),p(29930)],k=(function(h,u,m,v,l,f){const o={};let d={};const F=({notifications:n})=>new Promise(i=>{for(let a=0;a<n.length;a+=1)n[a].timeagoLong=$.timeago(new Date(parseInt(n[a].datetime,10)));h.toggleTimeagoShorthand(function(){for(let a=0;a<n.length;a+=1)n[a].timeago=$.timeago(new Date(parseInt(n[a].datetime,10))),n[a].timeagoShort=n[a].timeago;h.toggleTimeagoShorthand(),i({notifications:n})})});l.on("filter:notifications.load",F),o.loadNotifications=function(n,i,a){a=a||function(){},socket.emit("notifications.get",null,function(r,T){if(r)return f.error(r);const M=T.unread.concat(T.read).sort(function(B,P){return parseInt(B.datetime,10)>parseInt(P.datetime,10)?-1:1});l.fire("filter:notifications.load",{notifications:M}).then(({notifications:B})=>{app.parseAndTranslate("partials/notifications_list",{notifications:B},function(P){i.html(P),i.off("click").on("click","[data-nid]",function(D){const I=$(this);if(y(I)&&(D.stopPropagation(),D.preventDefault(),n&&n.dropdown("toggle")),!I.hasClass("unread"))return;const j=I.attr("data-nid");s(j,!0)}),u.get("notifications").on("click",".mark-all-read",()=>{o.markAllRead()}),o.handleUnreadButton(i),l.fire("action:notifications.loaded",{notifications:M,list:i}),a()})})})},o.handleUnreadButton=function(n){n.on("click",".mark-read",function(){const i=$(this),a=i.parents("[data-nid]"),r=a.hasClass("unread"),T=a.attr("data-nid");return s(T,r,function(){a.toggleClass("unread"),i.find(".unread").toggleClass("hidden",r),i.find(".read").toggleClass("hidden",!r)}),!1})},o.onNewNotification=function(n){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),!(ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(n.roomId,10))&&(socket.emit("notifications.getCount",function(i,a){if(i)return f.error(i);o.updateNotifCount(a)}),d[n.nid]||(d[n.nid]=n))},o.markNotification=function(n,i,a){s(n,i,a)};function s(n,i,a){socket.emit("notifications.mark"+(i?"Read":"Unread"),n,function(r){if(r)return f.error(r);i&&d[n]&&delete d[n],a&&a()})}function y(n){const i=n.attr("data-pid"),a=n.attr("data-path"),r=u.get("post","pid",i);return a.startsWith(config.relative_path+"/post/")&&i&&r.length&&ajaxify.data.template.topic?(m.scrollToIndex(r.attr("data-index"),!0),!0):!1}return o.updateNotifCount=function(n){const i=u.get("notifications/icon");n=Math.max(0,n),i.toggleClass("fa-bell",n>0).toggleClass("fa-bell-o",n<=0);const a=n>99?"99+":n;i.toggleClass("unread-count",n>0),i.attr("data-content",a),u.get("notifications/count").toggleClass("hidden",n<=0).text(a);const r={count:n,updateFavicon:!0};l.fire("action:notification.updateCount",r),r.updateFavicon&&v.setBubble(a),m.setAppBadge&&m.setAppBadge(n)},o.markAllRead=function(n=""){socket.emit("notifications.markAllRead",{filter:n},function(i){i&&f.error(i),n?Object.keys(d).forEach(r=>{d[r].type===n&&delete d[r]}):d={};const a=$('[component="notifications/list"] [data-nid]');a.removeClass("unread"),a.find(".mark-read .unread").addClass("hidden"),a.find(".mark-read .read").removeClass("hidden")})},o}).apply(O,b),k!==void 0&&(R.exports=k)}),40279:((R,O,p)=>{var b,k;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var h={},u=null,m=null,v=null,l=null,f={},o=Math.ceil(window.devicePixelRatio)||1,d=16*o,F={width:7,height:9,font:10*o+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},s=(function(){var t=navigator.userAgent.toLowerCase();return function(e){return t.indexOf(e)!==-1}})(),y={ie:s("trident"),chrome:s("chrome"),webkit:s("chrome")||s("safari"),safari:s("safari")&&!s("chrome"),mozilla:s("mozilla")&&!s("chrome")&&!s("safari")},n=function(){for(var t=document.getElementsByTagName("link"),e=0,c=t.length;e<c;e++)if((t[e].getAttribute("rel")||"").match(/\bicon\b/i))return t[e];return!1},i=function(){for(var t=document.getElementsByTagName("link"),e=0,c=t.length;e<c;e++){var E=typeof t[e]<"u";E&&(t[e].getAttribute("rel")||"").match(/\bicon\b/i)&&t[e].parentNode.removeChild(t[e])}},a=function(){if(!m||!u){var t=n();u=t?t.getAttribute("href"):"/favicon.ico",m||(m=u)}return u},r=function(){return l||(l=document.createElement("canvas"),l.width=d,l.height=d),l},T=function(t){if(t){i();var e=document.createElement("link");e.type="image/x-icon",e.rel="icon",e.href=t,document.getElementsByTagName("head")[0].appendChild(e)}},M=function(t){window.console&&window.console.log(t)},B=function(t,E){if(!r().getContext||y.ie||y.safari||f.fallback==="force")return P(t);var c=r().getContext("2d"),E=E||"#000000",S=a();v=document.createElement("img"),v.onload=function(){c.clearRect(0,0,d,d),c.drawImage(v,0,0,v.width,v.height,0,0,d,d),(t+"").length>0&&D(c,t,E),I()},!S.match(/^data/)&&f.crossOrigin&&(v.crossOrigin="anonymous"),v.src=S},P=function(t){if(f.fallback){var e=document.title;e[0]==="("&&(e=e.slice(e.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+e:document.title=e}},D=function(t,e,c){typeof e=="number"&&e>99&&f.abbreviate&&(e=U(e));var E=(e+"").length-1,S=f.width*o+6*o*E,W=f.height*o,N=d-W,w=d-S-o,C=16*o,A=16*o,g=2*o;t.font=(y.webkit?"bold ":"")+f.font,t.fillStyle=f.background,t.strokeStyle=f.background,t.lineWidth=o,t.beginPath(),t.moveTo(w+g,N),t.quadraticCurveTo(w,N,w,N+g),t.lineTo(w,C-g),t.quadraticCurveTo(w,C,w+g,C),t.lineTo(A-g,C),t.quadraticCurveTo(A,C,A,C-g),t.lineTo(A,N+g),t.quadraticCurveTo(A,N,A-g,N),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(w+g/2,C),t.lineTo(A-g/2,C),t.stroke(),t.fillStyle=f.color,t.textAlign="right",t.textBaseline="top",t.fillText(e,o===2?29:15,y.mozilla?7*o:6*o)},I=function(){r().getContext&&T(r().toDataURL())},U=function(t){for(var e=[["G",1e9],["M",1e6],["k",1e3]],c=0;c<e.length;++c)if(t>=e[c][1]){t=j(t/e[c][1])+e[c][0];break}return t},j=function(t,e){var c=new Number(t);return c.toFixed(e)};h.setOptions=function(t){f={},t.colour&&(t.color=t.colour);for(var e in F)f[e]=t.hasOwnProperty(e)?t[e]:F[e];return this},h.setImage=function(t){return u=t,I(),this},h.setBubble=function(t,e){return t=t||"",B(t,e),this},h.reset=function(){u=m,T(m)},h.setOptions(F),b=h,k=typeof b=="function"?b.call(O,p,O,R):b,k!==void 0&&(R.exports=k)})()})}]);
