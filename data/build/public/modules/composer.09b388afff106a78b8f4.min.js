(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,36159,46379,49897,52185,58540,62441,74566,88189,92332,98463,99127],{12236:((S,E,a)=>{"use strict";var h,p;h=[a(49897),a(29930)],p=(function(m,y){const l={};l.init=function(t,e){const n=t.find(".draft-icon"),o=t.attr("data-uuid");function s(){$(`[component="composer"][data-uuid="${o}"]`).length&&(e.save_id||(e.save_id=utils.generateSaveId(app.user.uid)),l.addToDraftList("available",e.save_id),l.addToDraftList("open",e.save_id),r(t,n,e))}t.on("keyup","textarea, input.handle, input.title",utils.debounce(s,1e3)),t.on("click",'input[type="checkbox"]',utils.debounce(s,1e3)),t.on("click",'[component="category/list"] [data-cid]',utils.debounce(s,1e3)),t.on("itemAdded",".tags",utils.debounce(s,1e3)),t.on("thumb.uploaded",s),n.on("animationend",function(){$(this).toggleClass("active",!1)}),$(window).on("unload",function(){const i=l.getList("open");i.length&&i.forEach(d=>l.removeFromDraftList("open",d))}),l.migrateGuest()};function v(t){return parseInt(t,10)>0?localStorage:sessionStorage}l.get=function(t){if(!t)return null;const e=t.split(":")[1],n=v(e);try{const o=n.getItem(t),s=JSON.parse(o)||null;if(!s)throw new Error(`can't parse draft json for ${t}`);return s.save_id=t,s.timestamp&&(s.timestampISO=utils.toISOString(s.timestamp)),$(window).trigger("action:composer.drafts.get",{save_id:t,draft:s,storage:n}),s}catch{return console.warn(`[composer/drafts] Could not get draft ${t}, removing`),l.removeFromDraftList("available"),l.removeFromDraftList("open"),null}};function r(t,e,n){if(c(app.user.uid?"localStorage":"sessionStorage")&&n&&n.save_id&&t.length){const o=t.find("input.title"),s=o&&o.length&&o.val(),i=t.find("textarea").val(),d=v(app.user.uid);if(i.length||s&&s.length){const f={save_id:n.save_id,action:n.action,text:i,uuid:t.attr("data-uuid"),timestamp:Date.now()};if(n.action==="topics.post"){const A=t.find("input.tags").val();f.tags=A,f.title=s,f.cid=n.cid,f.thumbs=n.thumbs||[]}else n.action==="posts.reply"?(f.title=n.title,f.tid=n.tid,f.toPid=n.toPid):n.action==="posts.edit"&&(f.pid=n.pid,f.title=s||n.title,f.thumbs=n.thumbs||[]);app.user.uid||(f.handle=t.find("input.handle").val()),d.setItem(n.save_id,JSON.stringify(f)),$(window).trigger("action:composer.drafts.save",{storage:d,postData:n,postContainer:t}),e.toggleClass("active",!0)}else l.removeDraft(n.save_id)}}l.removeDraft=function(t){if(!t)return;l.removeFromDraftList("available",t),l.removeFromDraftList("open",t);const e=t.split(":")[1],n=v(e);n.removeItem(t),$(window).trigger("action:composer.drafts.remove",{storage:n,save_id:t})},l.getList=function(t){try{const e=localStorage.getItem(`drafts:${t}`);return JSON.parse(e)||[]}catch{return console.warn("[composer/drafts] Could not read list of available drafts"),[]}},l.addToDraftList=function(t,e){if(!c(app.user.uid?"localStorage":"sessionStorage")||!e)return;const n=l.getList(t);n.includes(e)||(n.push(e),localStorage.setItem("drafts:"+t,JSON.stringify(n)))},l.removeFromDraftList=function(t,e){if(!c(app.user.uid?"localStorage":"sessionStorage")||!e)return;const n=l.getList(t);n.includes(e)&&(n.splice(n.indexOf(e),1),localStorage.setItem("drafts:"+t,JSON.stringify(n)))},l.migrateGuest=function(){if(c("localStorage")&&app.user.uid){const t=/^composer:\d+:\d$/,e=Object.keys(sessionStorage).filter(function(s){return t.test(s)}),n=new Set([]),o=e.map(function(s){const i=s.split(":");return i[1]=app.user.uid,n.add(i.join(":")),i.join(":")});return e.forEach(function(s,i){localStorage.setItem(o[i],sessionStorage.getItem(s)),sessionStorage.removeItem(s)}),n.forEach(function(s){l.addToDraftList("available",s)}),n}},l.listAvailable=function(){return l.getList("available").map(l.get).filter(Boolean)},l.getAvailableCount=function(){return l.listAvailable().length},l.open=function(t){if(!t)return;const e=l.get(t);u(t,e)},l.loadOpen=function(){if(ajaxify.data.template.login||ajaxify.data.template.register||config.hasOwnProperty("openDraftsOnPageLoad")&&!config.openDraftsOnPageLoad)return;const t=l.getList("available"),e=l.getList("open");t.length&&t.forEach(function(n){if(!n||e.includes(n))return;const o=l.get(n);if(!o||!o.text&&!o.title){l.removeFromDraftList("available",n),l.removeFromDraftList("open",n);return}u(n,o)})};function u(t,e){const o=t.split(":")[1];parseInt(app.user.uid,10)===parseInt(o,10)&&Promise.all([a.e(20056),a.e(23662),a.e(65285),a.e(40559),a.e(449),a.e(5785),a.e(58540)]).then(function(){var s=[a(71431)];(function(i){e.action==="topics.post"?i.newTopic({save_id:e.save_id,cid:e.cid,handle:app.user&&app.user.uid?void 0:utils.escapeHTML(e.handle),title:utils.escapeHTML(e.title),body:e.text,tags:String(e.tags||"").split(","),thumbs:e.thumbs||[]}):e.action==="posts.reply"?m.get("/topics/"+e.tid,{},function(d,f){if(d)return y.error(d);i.newReply({save_id:e.save_id,tid:e.tid,toPid:e.toPid,title:f.title,body:e.text})}):e.action==="posts.edit"&&i.editPost({save_id:e.save_id,pid:e.pid,title:e.title?utils.escapeHTML(e.title):void 0,body:e.text,thumbs:e.thumbs||[]})}).apply(null,s)}).catch(a.oe)}function c(t){var e;try{e=window[t];var n="__storage_test__";return e.setItem(n,n),e.removeItem(n),!0}catch(o){return o instanceof DOMException&&(o.code===22||o.code===1014||o.name==="QuotaExceededError"||o.name==="NS_ERROR_DOM_QUOTA_REACHED")&&e&&e.length!==0}}return l}).apply(E,h),p!==void 0&&(S.exports=p)}),24187:((S,E,a)=>{"use strict";var h,p;h=[a(64061)],p=(function(){const m={};m.show=function(r,u){const c=r.hasOwnProperty("fileSize")&&r.fileSize!==void 0?parseInt(r.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:r.hasOwnProperty("showHelp")&&r.showHelp!==void 0?r.showHelp:!0,fileSize:c,title:r.title||"[[global:upload-file]]",description:r.description||"",button:r.button||"[[global:upload]]",accept:r.accept?r.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const e=t.find("#uploadForm");e.attr("action",r.route),e.find("#params").val(JSON.stringify(r.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),e.submit()}),e.submit(function(){return y(t,c,u),!1})})},m.hideAlerts=function(r){$(r).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function y(r,u,c){l(r,"status","[[uploads:uploading-file]]"),r.find("#upload-progress-bar").css("width","0%"),r.find("#upload-progress-box").show().removeClass("hide");const t=r.find("#fileInput");if(!t.val())return l(r,"error","[[uploads:select-file-to-upload]]");if(!v(t[0],u))return l(r,"error","[[error:file-too-big, "+u+"]]");m.ajaxSubmit(r,c)}function l(r,u,c){m.hideAlerts(r),u==="error"&&r.find("#fileUploadSubmitBtn").removeClass("disabled"),c=c.replace(/&amp;#44/g,"&#44"),r.find("#alert-"+u).translateText(c).removeClass("hide")}m.ajaxSubmit=function(r,u){r.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=g(t),l(r,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,e,n,o){r.find("#upload-progress-bar").css("width",o+"%")},success:function(t){let e=g(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(e=t.response.images),u(e[0].url),l(r,"success","[[uploads:upload-success]]"),setTimeout(function(){m.hideAlerts(r),r.modal("hide")},750)}})};function g(r){if(typeof r=="string")try{return JSON.parse(r)}catch(u){return console.error(u),{error:"[[error:parse-error]]"}}return r}function v(r,u){return window.FileReader&&u?r.files[0].size<=u*1e3:!0}return m}).apply(E,h),p!==void 0&&(S.exports=p)}),36159:((S,E,a)=>{"use strict";var h,p;h=[a(49897),a(33530),a(29930),a(24187),a(81335),a(17459),a(65285)],p=(function(m,y,l,g,v,r){const u={};return u.get=c=>m.get(`/topics/${c}/thumbs`,{thumbsOnly:1}),u.delete=(c,t)=>m.del(`/topics/${c}/thumbs`,{path:t}),u.updateTopicThumbs=async c=>{const t=await u.get(c),e=await app.parseAndTranslate("partials/topic/thumbs",{thumbs:t});$('[component="topic/thumb/list"]').html(e)},u.deleteAll=c=>{u.get(c).then(t=>{Promise.all(t.map(e=>u.delete(c,e.url)))})},u.upload=()=>new Promise(c=>{g.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+"/api/topic/thumb/upload"},function(t){c(t)})}),u.modal={},u.modal.open=function(c){const{id:t,postData:e}=c;let{modal:n}=c;const o=e.thumbs||[];return new Promise(s=>{v.render("modals/topic-thumbs",{thumbs:o}).then(i=>{n?r.translate(i,function(d){n.find(".bootbox-body").html(d),u.modal.handleSort({modal:n,thumbs:o})}):(n=y.dialog({title:"[[modules:thumbs.modal.title]]",message:i,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(u.upload().then(d=>{e.thumbs.push(d.replace(new RegExp(`^${config.upload_url}`),"")),u.modal.open({...c,modal:n}),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var f=[a(71431)];(A=>{A.updateThumbCount(t,$(`[component="composer"][data-uuid="${t}"]`)),s()}).apply(null,f)}).catch(a.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),u.modal.handleDelete({...c,modal:n}),u.modal.handleSort({modal:n,thumbs:o}))})})},u.modal.handleDelete=c=>{const t=c.modal.get(0),{id:e}=c;t.addEventListener("click",n=>{n.target.closest('button[data-action="remove"]')&&y.confirm("[[modules:thumbs.modal.confirm-remove]]",o=>{if(!o)return;const s=n.target.closest("[data-path]").getAttribute("data-path"),i=c.postData;i&&i.thumbs&&i.thumbs.includes(s)&&(i.thumbs=i.thumbs.filter(d=>d!==s),u.modal.open(c),Promise.all([a.e(20056),a.e(40559),a.e(449),a.e(5785),a.e(52185)]).then(function(){var d=[a(71431)];(f=>{f.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`))}).apply(null,d)}).catch(a.oe))})})},u.modal.handleSort=({modal:c,thumbs:t})=>{if(t.length>1){const e=c.find(".topic-thumbs-modal");e.sortable({items:"[data-path]"}),e.on("sortupdate",function(){if(!t)return;const n=[];e.find("[data-path]").each(function(){const o=$(this).attr("data-path"),s=t.find(i=>i===o);s&&n.push(s)}),t.length=0,Array.prototype.push.apply(t,n)})}},u}).apply(E,h),p!==void 0&&(S.exports=p)}),49897:((S,E,a)=>{"use strict";a.r(E),a.d(E,{del:()=>n,get:()=>r,head:()=>u,patch:()=>t,post:()=>c,put:()=>e});var h=a(91749),p=a.n(h),m=a(33530),y=a.n(m);const l=config.relative_path+"/api/v3";async function g(o,s){if(o.url=o.url.startsWith("/api")?config.relative_path+o.url:l+o.url,typeof s=="function"){v(o).then(i=>s(null,i),i=>s(i));return}try{return await v(o)}catch(i){if(i.message==="A valid login session was not found. Please log in and try again."){const{url:d}=await(0,h.fire)("filter:admin.reauth",{url:"login"});return(0,m.confirm)("[[error:api.reauth-required]]",f=>{f&&ajaxify.go(d)})}throw i}}async function v(o){const{url:s}=o;delete o.url,o.data&&!(o.data instanceof FormData)&&(o.data=JSON.stringify(o.data||{}),o.headers["content-type"]="application/json; charset=utf-8"),{options:o}=await(0,h.fire)("filter:api.options",{options:o}),o.data&&(o.body=o.data,delete o.data);const i=await fetch(s,o),{headers:d}=i;if(d.get("x-redirect"))return v({url:d.get("x-redirect"),...o});const f=d.get("content-type"),A=f&&f.startsWith("application/json");let b;if(o.method!=="HEAD"&&(A?b=await i.json():b=await i.text()),!i.ok)throw b?new Error(A?b.status.message:b):new Error(i.statusText);return A&&b&&b.hasOwnProperty("status")&&b.hasOwnProperty("response")?b.response:b}function r(o,s,i){return g({url:o+(s&&Object.keys(s).length?"?"+$.param(s):"")},i)}function u(o,s,i){return g({url:o+(s&&Object.keys(s).length?"?"+$.param(s):""),method:"HEAD"},i)}function c(o,s,i){return g({url:o,method:"POST",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function t(o,s,i){return g({url:o,method:"PATCH",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function e(o,s,i){return g({url:o,method:"PUT",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}function n(o,s,i){return g({url:o,method:"DELETE",data:s,headers:{"x-csrf-token":config.csrf_token}},i)}}),74566:((S,E,a)=>{S.exports=a(12236)})}]);
