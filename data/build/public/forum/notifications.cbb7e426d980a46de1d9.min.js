(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[78783,81307],{5211:((y,w,v)=>{"use strict";var C,p;C=[v(52473),v(36849)],p=(function(l,s){const g={};return g.init=function(){const m=$(".notifications-list");m.on("click",'[component="notifications/item/link"]',function(){const h=$(this).parents("[data-nid]").attr("data-nid");s.markNotification(h,!0)}),s.handleUnreadButton(m),l.get("notifications/mark_all").on("click",function(){s.markAllRead(ajaxify.data.selectedFilter.filter,function(){l.get("notifications/item").removeClass("unread")})})},g}).apply(w,C),p!==void 0&&(y.exports=p)}),36849:((y,w,v)=>{"use strict";var C,p;C=[v(17459),v(52473),v(96352),v(40279),v(91749),v(29930)],p=(function(l,s,g,m,h,f){const o={};let d={};const P=({notifications:e})=>new Promise(a=>{for(let i=0;i<e.length;i+=1)e[i].timeagoLong=$.timeago(new Date(parseInt(e[i].datetime,10)));l.toggleTimeagoShorthand(function(){for(let i=0;i<e.length;i+=1)e[i].timeago=$.timeago(new Date(parseInt(e[i].datetime,10))),e[i].timeagoShort=e[i].timeago;l.toggleTimeagoShorthand(),a({notifications:e})})});h.on("filter:notifications.load",P),o.loadNotifications=function(e,a,i){i=i||function(){},socket.emit("notifications.get",null,function(r,A){if(r)return f.error(r);const S=A.unread.concat(A.read).sort(function(R,_){return parseInt(R.datetime,10)>parseInt(_.datetime,10)?-1:1});h.fire("filter:notifications.load",{notifications:S}).then(({notifications:R})=>{app.parseAndTranslate("partials/notifications_list",{notifications:R},function(_){a.html(_),a.off("click").on("click","[data-nid]",function(D){const F=$(this);if(I(F)&&(D.stopPropagation(),D.preventDefault(),e&&e.dropdown("toggle")),!F.hasClass("unread"))return;const M=F.attr("data-nid");u(M,!0)}),s.get("notifications").on("click",".mark-all-read",()=>{o.markAllRead()}),o.handleUnreadButton(a),h.fire("action:notifications.loaded",{notifications:S,list:a}),i()})})})},o.handleUnreadButton=function(e){e.on("click",".mark-read",function(){const a=$(this),i=a.parents("[data-nid]"),r=i.hasClass("unread"),A=i.attr("data-nid");return u(A,r,function(){i.toggleClass("unread"),a.find(".unread").toggleClass("hidden",r),a.find(".read").toggleClass("hidden",!r)}),!1})},o.onNewNotification=function(e){ajaxify.currentPage==="notifications"&&ajaxify.refresh(),!(ajaxify.data.template.chats&&parseInt(ajaxify.data.roomId,10)===parseInt(e.roomId,10))&&(socket.emit("notifications.getCount",function(a,i){if(a)return f.error(a);o.updateNotifCount(i)}),d[e.nid]||(d[e.nid]=e))},o.markNotification=function(e,a,i){u(e,a,i)};function u(e,a,i){socket.emit("notifications.mark"+(a?"Read":"Unread"),e,function(r){if(r)return f.error(r);a&&d[e]&&delete d[e],i&&i()})}function I(e){const a=e.attr("data-pid"),i=e.attr("data-path"),r=s.get("post","pid",a);return i.startsWith(config.relative_path+"/post/")&&a&&r.length&&ajaxify.data.template.topic?(g.scrollToIndex(r.attr("data-index"),!0),!0):!1}return o.updateNotifCount=function(e){const a=s.get("notifications/icon");e=Math.max(0,e),a.toggleClass("fa-bell",e>0).toggleClass("fa-bell-o",e<=0);const i=e>99?"99+":e;a.toggleClass("unread-count",e>0),a.attr("data-content",i),s.get("notifications/count").toggleClass("hidden",e<=0).text(i);const r={count:e,updateFavicon:!0};h.fire("action:notification.updateCount",r),r.updateFavicon&&m.setBubble(i),g.setAppBadge&&g.setAppBadge(e)},o.markAllRead=function(e=""){socket.emit("notifications.markAllRead",{filter:e},function(a){a&&f.error(a),e?Object.keys(d).forEach(r=>{d[r].type===e&&delete d[r]}):d={};const i=$('[component="notifications/list"] [data-nid]');i.removeClass("unread"),i.find(".mark-read .unread").addClass("hidden"),i.find(".mark-read .read").removeClass("hidden")})},o}).apply(w,C),p!==void 0&&(y.exports=p)}),40279:((y,w,v)=>{var C,p;/*!
* Tinycon - A small library for manipulating the Favicon
* Tom Moor, http://tommoor.com
* Copyright (c) 2015 Tom Moor
* @license MIT Licensed
*/(function(){var l={},s=null,g=null,m=null,h=null,f={},o=Math.ceil(window.devicePixelRatio)||1,d=16*o,P={width:7,height:9,font:10*o+"px arial",color:"#ffffff",background:"#F03D25",fallback:!0,crossOrigin:!0,abbreviate:!0},u=(function(){var t=navigator.userAgent.toLowerCase();return function(n){return t.indexOf(n)!==-1}})(),I={ie:u("trident"),chrome:u("chrome"),webkit:u("chrome")||u("safari"),safari:u("safari")&&!u("chrome"),mozilla:u("mozilla")&&!u("chrome")&&!u("safari")},e=function(){for(var t=document.getElementsByTagName("link"),n=0,c=t.length;n<c;n++)if((t[n].getAttribute("rel")||"").match(/\bicon\b/i))return t[n];return!1},a=function(){for(var t=document.getElementsByTagName("link"),n=0,c=t.length;n<c;n++){var b=typeof t[n]<"u";b&&(t[n].getAttribute("rel")||"").match(/\bicon\b/i)&&t[n].parentNode.removeChild(t[n])}},i=function(){if(!g||!s){var t=e();s=t?t.getAttribute("href"):"/favicon.ico",g||(g=s)}return s},r=function(){return h||(h=document.createElement("canvas"),h.width=d,h.height=d),h},A=function(t){if(t){a();var n=document.createElement("link");n.type="image/x-icon",n.rel="icon",n.href=t,document.getElementsByTagName("head")[0].appendChild(n)}},S=function(t){window.console&&window.console.log(t)},R=function(t,b){if(!r().getContext||I.ie||I.safari||f.fallback==="force")return _(t);var c=r().getContext("2d"),b=b||"#000000",O=i();m=document.createElement("img"),m.onload=function(){c.clearRect(0,0,d,d),c.drawImage(m,0,0,m.width,m.height,0,0,d,d),(t+"").length>0&&D(c,t,b),F()},!O.match(/^data/)&&f.crossOrigin&&(m.crossOrigin="anonymous"),m.src=O},_=function(t){if(f.fallback){var n=document.title;n[0]==="("&&(n=n.slice(n.indexOf(" "))),(t+"").length>0?document.title="("+t+") "+n:document.title=n}},D=function(t,n,c){typeof n=="number"&&n>99&&f.abbreviate&&(n=U(n));var b=(n+"").length-1,O=f.width*o+6*o*b,W=f.height*o,B=d-W,T=d-O-o,k=16*o,N=16*o,E=2*o;t.font=(I.webkit?"bold ":"")+f.font,t.fillStyle=f.background,t.strokeStyle=f.background,t.lineWidth=o,t.beginPath(),t.moveTo(T+E,B),t.quadraticCurveTo(T,B,T,B+E),t.lineTo(T,k-E),t.quadraticCurveTo(T,k,T+E,k),t.lineTo(N-E,k),t.quadraticCurveTo(N,k,N,k-E),t.lineTo(N,B+E),t.quadraticCurveTo(N,B,N-E,B),t.closePath(),t.fill(),t.beginPath(),t.strokeStyle="rgba(0,0,0,0.3)",t.moveTo(T+E/2,k),t.lineTo(N-E/2,k),t.stroke(),t.fillStyle=f.color,t.textAlign="right",t.textBaseline="top",t.fillText(n,o===2?29:15,I.mozilla?7*o:6*o)},F=function(){r().getContext&&A(r().toDataURL())},U=function(t){for(var n=[["G",1e9],["M",1e6],["k",1e3]],c=0;c<n.length;++c)if(t>=n[c][1]){t=M(t/n[c][1])+n[c][0];break}return t},M=function(t,n){var c=new Number(t);return c.toFixed(n)};l.setOptions=function(t){f={},t.colour&&(t.color=t.colour);for(var n in P)f[n]=t.hasOwnProperty(n)?t[n]:P[n];return this},l.setImage=function(t){return s=t,F(),this},l.setBubble=function(t,n){return t=t||"",R(t,n),this},l.reset=function(){s=g,A(g)},l.setOptions(P),C=l,p=typeof C=="function"?C.call(w,v,w,y):C,p!==void 0&&(y.exports=p)})()})}]);
