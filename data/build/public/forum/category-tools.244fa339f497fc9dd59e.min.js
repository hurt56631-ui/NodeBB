"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[14526,42619],{70550:((S,M,c)=>{var R,C;R=[c(52473)],C=(function(p){const v={};let i,d;v.init=function(o){d=$('[component="category"]'),d.on("selectstart",'[component="topic/select"]',function(s){s.preventDefault()}),d.on("click",'[component="topic/select"]',function(s){const r=$(this).parents('[component="category/topic"]');if(s.shiftKey)return A(r.attr("data-tid")),i=r,!1;const m=r.hasClass("selected");D(r,!m),i=r,typeof o=="function"&&o()})};function D(o,s){const u=o.find('[component="topic/select"]');u.toggleClass("fa-check-square-o",s),u.toggleClass("fa-square-o",!s),u.parents('[component="category/topic"]').toggleClass("selected",s),a()}function a(){const o=$('[component="topic/selected/badge"]');if(o.length){const s=d.find('[component="category/topic"].selected').length;o.text(s>0?s:"")}}v.getSelectedTids=function(){const o=[];return d&&d.find('[component="category/topic"].selected').each(function(){o.push($(this).attr("data-tid"))}),o},v.unselectAll=function(){d&&(d.find('[component="category/topic"].selected').removeClass("selected"),d.find('[component="topic/select"]').toggleClass("fa-check-square-o",!1).toggleClass("fa-square-o",!0),a())};function A(o){i||(i=$('[component="category/topic"]').first());const s=p.get("category/topic","tid",o).hasClass("selected"),u=E(o),r=E(i.attr("data-tid"));f(u,r,!s)}function f(o,s,u){if(o>s){const r=o;o=s,s=r}for(let r=o;r<=s;r+=1){const m=$('[component="category/topic"]').eq(r);D(m,u)}}function E(o){return p.get("category/topic","tid",o).index('[component="category/topic"]')}return v}).apply(M,R),C!==void 0&&(S.exports=C)}),71131:((S,M,c)=>{var R,C;R=[c(70550),c(60984),c(52473),c(49897),c(33530),c(29930)],C=(function(p,v,i,d,D,a){const A={};A.init=function(){p.init(r),N(),$('[component="category/topic"]').each((e,t)=>{v.observeTopicLabels($(t).find('[component="topic/labels"]'))}),i.get("topic/delete").on("click",function(){return f("del","/state","delete",s),!1}),i.get("topic/restore").on("click",function(){return f("put","/state","restore",s),!1}),i.get("topic/purge").on("click",function(){return f("del","","purge",u),!1}),i.get("topic/lock").on("click",function(){return f("put","/lock","lock",o),!1}),i.get("topic/unlock").on("click",function(){return f("del","/lock","unlock",o),!1}),i.get("topic/pin").on("click",function(){return f("put","/pin","pin",o),!1}),i.get("topic/unpin").on("click",function(){return f("del","/pin","unpin",o),!1}),i.get("topic/mark-unread-for-all").on("click",function(){const e=p.getSelectedTids();return e.length?(socket.emit("topics.markAsUnreadForAll",e,function(t){if(t)return a.error(t);a.success("[[topic:markAsUnreadForAll.success]]"),e.forEach(function(n){$('[component="category/topic"][data-tid="'+n+'"]').addClass("unread")}),o()}),!1):a.error("[[error:no-topics-selected]]")}),i.get("topic/move").on("click",function(){return c.e(28310).then(function(){var e=[c(28310)];(function(t){const n=p.getSelectedTids();if(!n.length)return a.error("[[error:no-topics-selected]]");t.init(n,null,o)}).apply(null,e)}).catch(c.oe),!1}),i.get("topic/move-all").on("click",function(){const e=ajaxify.data.cid;if(!ajaxify.data.template.category)return a.error("[[error:invalid-data]]");c.e(28310).then(function(){var t=[c(28310)];(function(n){n.init(null,e,function(l){if(l)return a.error(l);ajaxify.refresh()})}).apply(null,t)}).catch(c.oe)}),i.get("topic/merge").on("click",function(){const e=p.getSelectedTids();c.e(2403).then(function(){var t=[c(2403)];(function(n){n.init(function(){e.length&&e.forEach(function(l){n.addTopic(l)})})}).apply(null,t)}).catch(c.oe)}),i.get("topic/tag").on("click",async function(){const e=p.getSelectedTids();if(!e.length)return a.error("[[error:no-topics-selected]]");const t=await Promise.all(e.map(n=>d.get(`/topics/${n}`)));Promise.all([c.e(20056),c.e(63)]).then(function(){var n=[c(63)];(function(l){l.init(t,ajaxify.data.tagWhitelist,o)}).apply(null,n)}).catch(c.oe)}),A.removeListeners(),socket.on("event:topic_deleted",T),socket.on("event:topic_restored",T),socket.on("event:topic_purged",F),socket.on("event:topic_locked",L),socket.on("event:topic_unlocked",L),socket.on("event:topic_pinned",P),socket.on("event:topic_unpinned",P),socket.on("event:topic_moved",U)};function f(e,t,n,l){l||(l=function(){});const h=p.getSelectedTids(),k={},y=function(I){I&&Promise.all(h.map(x=>d[e](`/topics/${x}${t}`,k))).then(l).catch(a.error)};if(!h.length)return a.error("[[error:no-topics-selected]]");switch(n){case"delete":case"restore":case"purge":D.confirm(`[[topic:thread-tools.${n}-confirm]]`,y);break;case"pin":v.requestPinExpiry(k,y.bind(null,!0));break;default:y(!0);break}}A.removeListeners=function(){socket.removeListener("event:topic_deleted",T),socket.removeListener("event:topic_restored",T),socket.removeListener("event:topic_purged",F),socket.removeListener("event:topic_locked",L),socket.removeListener("event:topic_unlocked",L),socket.removeListener("event:topic_pinned",P),socket.removeListener("event:topic_unpinned",P),socket.removeListener("event:topic_moved",U)};function E(){$(".thread-tools .show").removeClass("show")}function o(){E(),p.unselectAll()}function s(){E(),r()}function u(){E(),p.unselectAll(),r()}function r(){const e=p.getSelectedTids(),t=m(B,e),n=j(B,e),l=m(Q,e),h=m(Y,e),k=m(K,e),y=j(K,e);i.get("topic/delete").toggleClass("hidden",t),i.get("topic/restore").toggleClass("hidden",k||!t),i.get("topic/purge").toggleClass("hidden",!n||!e.length),i.get("topic/lock").toggleClass("hidden",h),i.get("topic/unlock").toggleClass("hidden",!h),i.get("topic/pin").toggleClass("hidden",y||l),i.get("topic/unpin").toggleClass("hidden",y||!l),i.get("topic/merge").toggleClass("hidden",k)}function m(e,t){for(let n=0;n<t.length;n+=1)if(e(t[n]))return!0;return!1}function j(e,t){for(let n=0;n<t.length;n+=1)if(!e(t[n]))return!1;return!0}function B(e){return g(e).hasClass("deleted")}function Y(e){return g(e).hasClass("locked")}function Q(e){return g(e).hasClass("pinned")}function K(e){return g(e).hasClass("scheduled")}function g(e){return i.get("category/topic","tid",e)}function T(e){const t=g(e.tid);t.toggleClass("deleted",e.isDeleted),t.find('[component="topic/locked"]').toggleClass("hidden",!e.isDeleted)}function P(e){const t=g(e.tid);t.toggleClass("pinned",e.isPinned),t.find('[component="topic/pinned"]').toggleClass("hidden",!e.isPinned),ajaxify.refresh()}function L(e){const t=g(e.tid);t.toggleClass("locked",e.isLocked),t.find('[component="topic/locked"]').toggleClass("hidden",!e.isLocked)}async function U(e){if(ajaxify.data.template.category||String(e.toCid)==="-1")g(e.tid).remove();else{const t=await d.get(`/categories/${e.toCid}`),n=await app.parseAndTranslate("partials/topics_list",{topics:[{...e,category:t}]}),l=`[component="category/topic"][data-tid="${e.tid}"] [component="topic/category"]`;$(l).replaceWith(n.find(l))}}function F(e){g(e.tid).remove()}function N(){if(!ajaxify.data.topics||!ajaxify.data.template.category)return;const e=ajaxify.data.topics.filter(t=>t.pinned).length;!app.user.isAdmin&&!app.user.isMod||e<2||app.loadJQueryUI(function(){const t=$('[component="category"]').filter(function(l,h){return!$(h).parents("[widget-area],[data-widget-area]").length});let n=0;t.sortable({axis:"y",handle:'[component="topic/pinned"]',items:'[component="category/topic"].pinned',start:function(){n=parseInt(t.find('[component="category/topic"].pinned').first().attr("data-index"),10)},update:function(l,h){const k=h.item.attr("data-tid"),y=t.find('[component="category/topic"].pinned');let I=0;y.each((x,W)=>{if($(W).attr("data-tid")===k)return I=x,!1}),socket.emit("topics.orderPinnedTopics",{tid:k,order:n+I},function(x){if(x)return a.error(x);y.each((W,b)=>{$(b).attr("data-index",n+W)})})}})})}return A}).apply(M,R),C!==void 0&&(S.exports=C)})}]);
