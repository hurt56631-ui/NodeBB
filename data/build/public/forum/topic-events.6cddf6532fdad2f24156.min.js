"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[98088],{57642:((A,C,e)=>{var S,u;S=[e(8454),e(60984),e(47536),e(2269),e(52473),e(17459),e(91749),e(30076)],u=(function(g,r,m,k,c,a,E,j){const f={},y={"event:user_status_change":R,"event:voted":I,"event:bookmarked":B,"event:topic_deleted":r.setDeleteState,"event:topic_restored":r.setDeleteState,"event:topic_purged":O,"event:topic_locked":r.setLockedState,"event:topic_unlocked":r.setLockedState,"event:topic_pinned":r.setPinnedState,"event:topic_unpinned":r.setPinnedState,"event:topic_moved":L,"event:post_edited":b,"event:post_purged":D,"event:post_deleted":P,"event:post_restored":P,"posts.bookmark":x,"posts.unbookmark":x,"posts.upvote":v,"posts.downvote":v,"posts.unvote":v,"event:new_notification":M,"event:new_post":m.onNewPost};f.init=function(){f.removeListeners();for(const[t,o]of Object.entries(y))socket.on(t,o)},f.removeListeners=function(){for(const[t,o]of Object.entries(y))socket.removeListener(t,o)};function R(t){app.updateUserStatus($('[data-uid="'+t.uid+'"] [component="user/status"]'),t.status)}function I(t){const o=$('[data-pid="'+t.post.pid+'"] [component="post/vote-count"]').filter(function(p,d){return $(d).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}),i=$('.reputation[data-uid="'+t.post.uid+'"]');o.html(t.post.votes).attr("data-votes",t.post.votes),i.html(t.user.reputation).attr("data-reputation",t.user.reputation)}function B(t){$('[data-pid="'+t.post.pid+'"] .bookmarkCount').filter(function(o,i){return $(i).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).html(t.post.bookmarks).attr("data-bookmarks",t.post.bookmarks)}function O(t){ajaxify.data.category&&ajaxify.data.category.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("category/"+ajaxify.data.category.slug,null,!0)}function L(t){t&&t.slug&&String(t.tid)===String(ajaxify.data.tid)&&ajaxify.go("topic/"+t.slug,null,!0)}function b(t){if(!t||!t.post||String(t.post.tid)!==String(ajaxify.data.tid))return;const o=c.get("post/content",t.post.pid).filter(function(n,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),i=$(`[data-pid="${t.post.pid}"]`),p=i.find('[component="post/editor"]').filter(function(n,s){return String($(s).closest("[data-pid]").attr("data-pid"))===String(t.post.pid)}),d=c.get("topic/title"),l=c.get("navbar/title").find("span"),h=c.get("breadcrumb/current");if(t.topic.rescheduled)return ajaxify.go("topic/"+t.topic.slug,null,!0);if(d.length&&t.topic.title&&t.topic.renamed){ajaxify.data.title=t.topic.title;const n="topic/"+t.topic.slug+(window.location.search?window.location.search:"");history.replaceState({url:n},null,window.location.protocol+"//"+window.location.host+config.relative_path+"/"+n),d.fadeOut(250,function(){d.html(t.topic.title).fadeIn(250)}),h.fadeOut(250,function(){h.html(t.topic.title).fadeIn(250)}),l.fadeOut(250,function(){l.html(t.topic.title).fadeIn(250)})}if(t.post.changed){o.fadeOut(250,function(){if(o.html(a.unescape(t.post.content)),o.find("img:not(.not-responsive)").addClass("img-fluid"),k.wrapImagesInLinks(o.parent()),m.addBlockquoteEllipses(o.parent()),o.fadeIn(250),t.post.edited){const s={editor:t.editor,editedISO:utils.toISOString(t.post.edited)};app.parseAndTranslate("partials/topic/post-editor",s,function(N){p.replaceWith(N),i.find('[component="post/edit-indicator"]').removeClass("hidden").translateAttr("title",`[[global:edited-timestamp, ${j.isoTimeToLocaleString(s.editedISO,config.userLang)}]]`),i.find('[component="post/editor"] .timeago').timeago(),E.fire("action:posts.edited",t)})}});const n=$(`[component="post/parent"][data-parent-pid="${t.post.pid}"]`);n.length&&(n.find('[component="post/parent/content"]').html(a.unescape(t.post.content)),n.find("img:not(.not-responsive)").addClass("img-fluid"),n.find('[component="post/parent/content"] img:not(.emoji)').each(function(){k.wrapImageInLink($(this))}))}else E.fire("action:posts.edited",t);t.topic.tags&&t.topic.tagsupdated&&Promise.all([e.e(20056),e.e(63)]).then(function(){var n=[e(63)];(function(s){s.updateTopicTags([t.topic])}).apply(null,n)}).catch(e.oe),t.topic.thumbsupdated&&Promise.all([e.e(23662),e.e(65285),e.e(36159)]).then(function(){var n=[e(36159)];(function(s){s.updateTopicThumbs(t.topic.tid)}).apply(null,n)}).catch(e.oe),g.removeMenu(c.get("post","pid",t.post.pid))}function D(t){!t||String(t.tid)!==String(ajaxify.data.tid)||(c.get("post","pid",t.pid).fadeOut(500,function(){$(this).remove(),m.showBottomPostBar()}),ajaxify.data.postcount-=1,g.updatePostCount(ajaxify.data.postcount),e.e(18631).then(function(){var o=[e(18631)];(function(i){i.onPostPurged(t)}).apply(null,o)}).catch(e.oe),$(`[component="post/parent"][data-parent-pid="${t.pid}"]`).remove())}function P(t){const o=c.get("post","pid",t.pid),{isAdminOrMod:i}=ajaxify.data.privileges,p=String(t.uid)===String(app.user.uid),d=!!t.deleted;o.length&&(o.toggleClass("deleted"),g.toggle(t.pid,d),!i&&!p&&(o.find('[component="post/tools"]').toggleClass("hidden",d),d?o.find('[component="post/content"]').translateHtml("[[topic:post-is-deleted]]"):o.find('[component="post/content"]').html(a.unescape(t.content))));const l=$(`[component="post/parent"][data-parent-pid="${t.pid}"]`);l.length&&l.each((h,n)=>{const s=$(n);d?s.find('[component="post/parent/content"]').translateHtml("[[topic:post-is-deleted]]"):s.find('[component="post/parent/content"]').html(a.unescape(t.content))})}function x(t){const o=$('[data-pid="'+t.post.pid+'"] [component="post/bookmark"]').filter(function(i,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)});o.length&&(o.attr("data-bookmarked",t.isBookmarked),o.find('[component="post/bookmark/on"]').toggleClass("hidden",!t.isBookmarked),o.find('[component="post/bookmark/off"]').toggleClass("hidden",t.isBookmarked))}function v(t){const o=$('[data-pid="'+t.post.pid+'"]');o.find('[component="post/upvote"]').filter(function(i,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("upvoted",t.upvote),o.find('[component="post/downvote"]').filter(function(i,p){return $(p).closest("[data-pid]").attr("data-pid")===String(t.post.pid)}).toggleClass("downvoted",t.downvote)}function M(t){const o=ajaxify.data.tid;t&&t.tid&&String(t.tid)===String(o)&&socket.emit("topics.markTopicNotificationsRead",[o])}return f}).apply(C,S),u!==void 0&&(A.exports=u)})}]);
