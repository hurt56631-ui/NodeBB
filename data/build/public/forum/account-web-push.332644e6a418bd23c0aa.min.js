(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,3452,34271,49897,99127],{4812:((E,d,a)=>{"use strict";a.r(d),a.d(d,{init:()=>p});var c=a(49897),y=a(29930);async function p(){const u=document.querySelector('[component="web-push-form"]');if(!u){console.error("Web Push form container not found");return}const s=await navigator.serviceWorker.ready;let r=await s.pushManager.getSubscription();const i=v(config["web-push"].vapidKey);u.addEventListener("click",async h=>{const b=h.target.closest("[data-action]");if(b)switch(h.target.getAttribute("data-action")){case"test":{r?(await(0,c.post)("/plugins/web-push/test",{subscription:r}),(0,y.success)("[[web-push:toast.test_success]]")):(0,y.warning)("[[web-push:toast.test_unavailable]]");break}case"toggle":{const t=document.querySelector("#deviceCount strong");if(r){await r.unsubscribe(),await(0,c.del)("/plugins/web-push/subscription",{subscription:r.toJSON()});let e=parseInt(t.textContent,10);e-=1,t.innerText=e,r=null}else try{r=await s.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:i}),await(0,c.post)("/plugins/web-push/subscription",{subscription:r.toJSON()});let e=parseInt(t.textContent,10);e+=1,t.innerText=e}catch{b.checked=!1}break}}});const f=document.getElementById("enabled");r&&(f.checked=!0),await s.pushManager.permissionState({userVisibleOnly:!0,applicationServerKey:i})==="denied"&&document.getElementById("permission-warning").classList.remove("d-none")}function v(u){for(var s="=".repeat((4-u.length%4)%4),r=(u+s).replace(/-/g,"+").replace(/_/g,"/"),i=window.atob(r),f=new Uint8Array(i.length),l=0;l<i.length;++l)f[l]=i.charCodeAt(l);return f}}),43586:((E,d,a)=>{E.exports=a(4812)}),49897:((E,d,a)=>{"use strict";a.r(d),a.d(d,{del:()=>O,get:()=>i,head:()=>f,patch:()=>h,post:()=>l,put:()=>b});var c=a(91749),y=a.n(c),p=a(33530),v=a.n(p);const u=config.relative_path+"/api/v3";async function s(t,e){if(t.url=t.url.startsWith("/api")?config.relative_path+t.url:u+t.url,typeof e=="function"){r(t).then(n=>e(null,n),n=>e(n));return}try{return await r(t)}catch(n){if(n.message==="A valid login session was not found. Please log in and try again."){const{url:g}=await(0,c.fire)("filter:admin.reauth",{url:"login"});return(0,p.confirm)("[[error:api.reauth-required]]",w=>{w&&ajaxify.go(g)})}throw n}}async function r(t){const{url:e}=t;delete t.url,t.data&&!(t.data instanceof FormData)&&(t.data=JSON.stringify(t.data||{}),t.headers["content-type"]="application/json; charset=utf-8"),{options:t}=await(0,c.fire)("filter:api.options",{options:t}),t.data&&(t.body=t.data,delete t.data);const n=await fetch(e,t),{headers:g}=n;if(g.get("x-redirect"))return r({url:g.get("x-redirect"),...t});const w=g.get("content-type"),m=w&&w.startsWith("application/json");let o;if(t.method!=="HEAD"&&(m?o=await n.json():o=await n.text()),!n.ok)throw o?new Error(m?o.status.message:o):new Error(n.statusText);return m&&o&&o.hasOwnProperty("status")&&o.hasOwnProperty("response")?o.response:o}function i(t,e,n){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):"")},n)}function f(t,e,n){return s({url:t+(e&&Object.keys(e).length?"?"+$.param(e):""),method:"HEAD"},n)}function l(t,e,n){return s({url:t,method:"POST",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function h(t,e,n){return s({url:t,method:"PATCH",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function b(t,e,n){return s({url:t,method:"PUT",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}function O(t,e,n){return s({url:t,method:"DELETE",data:e,headers:{"x-csrf-token":config.csrf_token}},n)}})}]);
