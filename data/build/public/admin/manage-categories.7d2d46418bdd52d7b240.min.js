"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,49897,69185,86198,90479,99127],{29195:((D,w,d)=>{var E,b;E=[d(17459),d(81335),d(65348),d(49897),d(10246),d(33530),d(29930)],b=(function(v,x,A,m,u,a,r){u=u.default;const s={};let o=-1,p;s.init=function(){A.init($('[component="category-selector"]'),{parentCid:ajaxify.data.selectedCategory?ajaxify.data.selectedCategory.cid:0,onSelect:function(t){ajaxify.go("/admin/manage/categories"+(t.cid?"?cid="+t.cid:""))},cacheList:!1,localCategories:[],template:"admin/partials/category/selector-dropdown-right"}),s.render(ajaxify.data.categoriesTree),$('button[data-action="create"]').on("click",s.throwCreateModal),$('button[data-action="add"]').on("click",s.throwAddModal),$(".categories").on("click",'.category-tools [data-action="toggle"]',function(){const t=$(this),n=t.attr("data-disable-cid"),g=t.parents('li[data-cid="'+n+'"]'),l=g.hasClass("disabled"),f=g.find("li[data-cid]").map(function(){return $(this).attr("data-cid")}).get();s.toggle([n].concat(f),!l)}),$(".categories").on("click",".toggle",function(){const t=$(this);t.find("i").toggleClass("fa-chevron-down").toggleClass("fa-chevron-right"),t.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden");const n=t.closest("[data-cid]").find("> ul.has-more-categories");parseInt(n.attr("data-hasmore"),10)===1&&n.toggleClass("hidden")}),$(".categories").on("click",".set-order",function(){const t=$(this).attr("data-cid"),n=$(this).attr("data-order"),g=a.dialog({title:"[[admin/manage/categories:set-order]]",message:'<input type="number" min="1" class="form-control input-lg" value='+n+' /><p class="form-text">[[admin/manage/categories:set-order-help]]</p>',show:!0,buttons:{save:{label:"[[modules:bootbox.confirm]]",className:"btn-primary",callback:function(){const l=g.find("input").val();if(l&&t){const y={};y[t]={order:Math.max(1,parseInt(l,10))},m.put("/categories/"+encodeURIComponent(t),y[t]).then(function(){ajaxify.refresh()}).catch(r.error)}else return!1}}}})}),$(".categories").on("click","a[data-action]",function(){switch(this.getAttribute("data-action")){case"remove":{s.remove.call(this);break}case"rename":{s.rename.call(this);break}}}),$("#toggle-collapse-all").on("click",function(){const t=$(this),n=parseInt(t.attr("data-collapsed"),10)===1;e(n),t.attr("data-collapsed",n?0:1).translateText(n?"[[admin/manage/categories:collapse-all]]":"[[admin/manage/categories:expand-all]]")});function e(t){const n=$(".categories .toggle");n.find("i").toggleClass("fa-chevron-down",t).toggleClass("fa-chevron-right",!t),n.closest("[data-cid]").find("> ul[data-cid]").toggleClass("hidden",!t)}},s.throwCreateModal=function(){x.render("admin/partials/categories/create",{}).then(function(e){const t=a.dialog({title:"[[admin/manage/categories:alert.create]]",message:e,buttons:{save:{label:"[[global:create]]",className:"btn-primary",callback:y}}}),n={localCategories:[{cid:0,name:"[[admin/manage/categories:parent-category-none]]",icon:"fa-none"}],template:"admin/partials/category/selector-dropdown-left"},g=A.init(t.find('#parentCidGroup [component="category-selector"]'),n),l=A.init(t.find('#cloneFromCidGroup [component="category-selector"]'),n);function y(){const f=t.find("form").serializeObject();return f.description="",f.icon="fa-comments",f.uid=app.user.uid,f.parentCid=g.getSelectedCid(),f.cloneFromCid=l.getSelectedCid(),s.create(f),t.modal("hide"),!1}$("#cloneChildren").on("change",function(){const f=$(this),C=t.find('#parentCidGroup [component="category-selector"] .dropdown-toggle');f.prop("checked")?(C.attr("disabled","disabled"),g.selectCategory(0)):C.removeAttr("disabled")}),t.find("form").on("submit",y)})},s.throwAddModal=function(){x.render("admin/partials/categories/add",{}).then(function(e){const t=a.dialog({title:"[[admin/manage/categories:alert.add]]",message:e,buttons:{save:{label:"[[global:save]]",className:"btn-primary",callback:n}}});function n(){const g=t.find("form").serializeObject();return m.post("/api/admin/manage/categories",g).then(()=>{ajaxify.refresh(),t.modal("hide")}).catch(r.error),!1}t.find("form").on("submit",n)})},s.remove=function(){a.confirm("[[admin/manage/categories:alert.confirm-remove]]",e=>{if(e){const t=this.getAttribute("data-cid");m.del(`/api/admin/manage/categories/${encodeURIComponent(t)}`).then(ajaxify.refresh)}})},s.rename=function(){a.prompt({title:"[[admin/manage/categories:alert.rename]]",message:'<p class="mb-3">[[admin/manage/categories:alert.rename-help]]</p>',callback:e=>{const t=this.getAttribute("data-cid");m.post(`/api/admin/manage/categories/${encodeURIComponent(t)}/name`,{name:e}).then(ajaxify.refresh)}})},s.create=function(e){m.post("/categories",e,function(t,n){if(t)return r.error(t);r.alert({alert_id:"category_created",title:"[[admin/manage/categories:alert.created]]",message:"[[admin/manage/categories:alert.create-success]]",type:"success",timeout:2e3}),ajaxify.go("admin/manage/categories/"+n.cid)})},s.render=function(e){const t=$(".categories");!e||!e.length?v.translate("[[admin/manage/categories:alert.none-active]]",function(n){$("<div></div>").addClass("alert alert-info text-center").text(n).appendTo(t)}):(p={},i(e,t,{cid:0}))},s.toggle=function(e,t){const n=document.querySelector('.categories [data-cid="0"]');Promise.all(e.map(g=>m.put("/categories/"+encodeURIComponent(g),{disabled:t?1:0}).then(()=>{const l=n.querySelector(`li[data-cid="${g}"]`);l.classList[t?"add":"remove"]("disabled"),$(l).find('li a[data-action="toggle"]').first().translateText(t?"[[admin/manage/categories:enable]]":"[[admin/manage/categories:disable]]")}).catch(r.error)))};function h(e){o=e.to.dataset.cid}function c(e){const t=parseInt(o,10)!==-1;if(e.newIndex!=null&&parseInt(e.oldIndex,10)!==parseInt(e.newIndex,10)||t){const n=e.item.dataset.cid,g={},l=(ajaxify.data.pagination.currentPage-1)*ajaxify.data.categoriesPerPage;if(g[n]={order:l+e.newIndex+1},t){g[n].parentCid=o;const y=parseInt(e.from.getAttribute("data-cid"),10),f=parseInt(e.to.getAttribute("data-cid"),10);if(y!==f){const C=document.querySelector(`.categories li[data-cid="${f}"] .toggle`);if(C&&C.classList.toggle("invisible",!1),!document.querySelectorAll(`.categories li[data-cid="${y}"] ul[data-cid] li[data-cid]`).length){const I=document.querySelector(`.categories li[data-cid="${y}"] .toggle`);I&&I.classList.toggle("invisible",!0)}e.item.dataset.parentCid=f}}o=-1,m.put("/categories/"+encodeURIComponent(n),g[n]).catch(r.error)}}function i(e,t,n){let g=0;const l=n.cid;e.forEach(function(f,C,P){v.translate(f.name,function(I){f.name!==I&&(f.name=I),g+=1,g===P.length&&y()})}),e.length||y();function y(){app.parseAndTranslate("admin/partials/categories/category-rows",{cid:n.cid,categories:e,parentCategory:n},function(f){t.find(".category-row").length?t.find(".category-row").after(f):t.append(f),e.length||t.get(0).querySelector(".toggle").classList.toggle("invisible",!0);for(let C=0,P=e.length;C<P;C+=1)i(e[C].children,$('li[data-cid="'+e[C].cid+'"]'),e[C]);p[l]=u.create($('ul[data-cid="'+l+'"]')[0],{group:"cross-categories",animation:150,handle:".information",dataIdAttr:"data-cid",ghostClass:"placeholder",onAdd:h,onEnd:c})})}}return s}).apply(w,E),b!==void 0&&(D.exports=b)}),49897:((D,w,d)=>{d.r(w),d.d(w,{del:()=>h,get:()=>a,head:()=>r,patch:()=>o,post:()=>s,put:()=>p});var E=d(91749),b=d.n(E),v=d(33530),x=d.n(v);const A=config.relative_path+"/api/v3";async function m(c,i){if(c.url=c.url.startsWith("/api")?config.relative_path+c.url:A+c.url,typeof i=="function"){u(c).then(e=>i(null,e),e=>i(e));return}try{return await u(c)}catch(e){if(e.message==="A valid login session was not found. Please log in and try again."){const{url:t}=await(0,E.fire)("filter:admin.reauth",{url:"login"});return(0,v.confirm)("[[error:api.reauth-required]]",n=>{n&&ajaxify.go(t)})}throw e}}async function u(c){const{url:i}=c;delete c.url,c.data&&!(c.data instanceof FormData)&&(c.data=JSON.stringify(c.data||{}),c.headers["content-type"]="application/json; charset=utf-8"),{options:c}=await(0,E.fire)("filter:api.options",{options:c}),c.data&&(c.body=c.data,delete c.data);const e=await fetch(i,c),{headers:t}=e;if(t.get("x-redirect"))return u({url:t.get("x-redirect"),...c});const n=t.get("content-type"),g=n&&n.startsWith("application/json");let l;if(c.method!=="HEAD"&&(g?l=await e.json():l=await e.text()),!e.ok)throw l?new Error(g?l.status.message:l):new Error(e.statusText);return g&&l&&l.hasOwnProperty("status")&&l.hasOwnProperty("response")?l.response:l}function a(c,i,e){return m({url:c+(i&&Object.keys(i).length?"?"+$.param(i):"")},e)}function r(c,i,e){return m({url:c+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},e)}function s(c,i,e){return m({url:c,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function o(c,i,e){return m({url:c,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function p(c,i,e){return m({url:c,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}function h(c,i,e){return m({url:c,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},e)}}),65348:((D,w,d)=>{var E,b;E=[d(96349),d(33530),d(91749),d(17459)],b=(function(v,x,A,m){const u={};return u.init=function(a,r){if(!a||!a.length)return;r=r||{};const s=r.onSelect||function(){};r.states=r.states||["watching","tracking","notwatching","ignoring"],r.template=r.template||"partials/category/selector-dropdown-left",A.fire("action:category.selector.options",{el:a,options:r}),v.init(a,r);const o={el:a,selectedCategory:null};a.on("click","[data-cid]",function(){const h=$(this);return h.hasClass("disabled")?!1:(o.selectCategory(h.attr("data-cid")),s(o.selectedCategory))});let p=o.el.find('[component="category-selector-selected"]').html();return m.translate(p,h=>{p=h}),o.selectCategory=function(h){const c=o.el.find('[data-cid="'+h+'"]');o.selectedCategory={cid:h,name:c.attr("data-name")},c.length?o.el.find('[component="category-selector-selected"]').html(c.find('[component="category-markup"]').html()):o.el.find('[component="category-selector-selected"]').html(p)},o.getSelectedCategory=function(){return o.selectedCategory},o.getSelectedCid=function(){return o.selectedCategory?o.selectedCategory.cid:0},r.hasOwnProperty("selectedCategory")&&app.parseAndTranslate(r.template,{selectedCategory:r.selectedCategory},function(h){o.el.find('[component="category-selector-selected"]').html(h.find('[component="category-selector-selected"]').html())}),o},u.modal=function(a){a=a||{},a.onSelect=a.onSelect||function(){},a.onSubmit=a.onSubmit||function(){},app.parseAndTranslate("admin/partials/categories/select-category",{message:a.message},function(r){const s=x.dialog({title:a.title||"[[modules:composer.select-category]]",message:r,buttons:{save:{label:"[[global:select]]",className:"btn-primary",callback:p}}}),o=u.init(s.find('[component="category-selector"]'),a);function p(h){return h.preventDefault(),o.selectedCategory&&(a.onSubmit(o.selectedCategory),s.modal("hide")),!1}a.openOnLoad&&s.on("shown.bs.modal",function(){s.find(".dropdown-toggle").dropdown("toggle")}),s.find("form").on("submit",p)})},u}).apply(w,E),b!==void 0&&(D.exports=b)}),96349:((D,w,d)=>{var E,b;E=[d(29930),d(89336),d(49897)],b=(function(v,x,A){const m={};return m.init=function(u,a){let r=a.defaultCategories||null;a=a||{},a.privilege=a.privilege||"topics:read",a.states=a.states||["watching","tracking","notwatching","ignoring"],a.cacheList=a.hasOwnProperty("cacheList")?a.cacheList:!0;let s=[];Array.isArray(a.localCategories)&&(s=a.localCategories.map(i=>({...i})),r&&(r=[...s,...r])),a.selectedCids=a.selectedCids||ajaxify.data.selectedCids||[];const o=u.find('[component="category-selector-search"]');if(!o.length)return;const p=o.parents('[component="category/dropdown"]').length>0||o.parents('[component="category-selector"]').length>0;u.on("show.bs.dropdown",function(){p&&o.removeClass("hidden");function i(){const e=o.find("input").val();e.length>1||!e&&!r?h(e,function(t){r=a.cacheList&&(r||t),c(t)}):!e&&r&&c(r)}o.on("click",function(e){e.preventDefault(),e.stopPropagation()}),o.find("input").val("").on("keyup",utils.debounce(i,300)),i()}),u.on("shown.bs.dropdown",function(){["xs","sm"].includes(utils.findBootstrapEnvironment())||o.find("input").focus()}),u.on("hide.bs.dropdown",function(){p&&o.addClass("hidden"),o.off("click"),o.find("input").off("keyup")});function h(i,e){A.get("/search/categories",{search:i,query:utils.params(),parentCid:a.parentCid||0,selectedCids:a.selectedCids,privilege:a.privilege,states:a.states,showLinks:a.showLinks},function(t,{categories:n}){if(t)return v.error(t);e(s.concat(n))})}function c(i){const e=a.selectedCids.map(String);i.forEach(function(t){t.selected=e.includes(String(t.cid))}),app.parseAndTranslate(a.template,{categoryItems:i.slice(0,200),selectedCategory:ajaxify.data.selectedCategory,allCategoriesUrl:ajaxify.data.allCategoriesUrl},function(t){u.find('[component="category/list"]').html(t.find('[component="category/list"]').html()),u.find('[component="category/list"] [component="category/no-matches"]').toggleClass("hidden",!!i.length);const n=x.Dropdown.getInstance(u.find(".dropdown-toggle").get(0));n&&n.update()})}},m}).apply(w,E),b!==void 0&&(D.exports=b)})}]);
