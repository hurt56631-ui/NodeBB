"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[8399,18470,61396,98463],{24187:((O,E,f)=>{var x,A;x=[f(64061)],A=(function(){const y={};y.show=function(i,r){const e=i.hasOwnProperty("fileSize")&&i.fileSize!==void 0?parseInt(i.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:i.hasOwnProperty("showHelp")&&i.showHelp!==void 0?i.showHelp:!0,fileSize:e,title:i.title||"[[global:upload-file]]",description:i.description||"",button:i.button||"[[global:upload]]",accept:i.accept?i.accept.replace(/,/g,"&#44; "):""},function(t){t.modal("show"),t.on("hidden.bs.modal",function(){t.remove()});const n=t.find("#uploadForm");n.attr("action",i.route),n.find("#params").val(JSON.stringify(i.params)),t.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),n.submit()}),n.submit(function(){return C(t,e,r),!1})})},y.hideAlerts=function(i){$(i).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function C(i,r,e){g(i,"status","[[uploads:uploading-file]]"),i.find("#upload-progress-bar").css("width","0%"),i.find("#upload-progress-box").show().removeClass("hide");const t=i.find("#fileInput");if(!t.val())return g(i,"error","[[uploads:select-file-to-upload]]");if(!v(t[0],r))return g(i,"error","[[error:file-too-big, "+r+"]]");y.ajaxSubmit(i,e)}function g(i,r,e){y.hideAlerts(i),r==="error"&&i.find("#fileUploadSubmitBtn").removeClass("disabled"),e=e.replace(/&amp;#44/g,"&#44"),i.find("#alert-"+r).translateText(e).removeClass("hide")}y.ajaxSubmit=function(i,r){i.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(t){t=h(t),g(i,"error",t.responseJSON?.status?.message||t.responseJSON?.error||`[[error:upload-error-fallback, ${t.status} ${t.statusText}]]`)},uploadProgress:function(t,n,s,a){i.find("#upload-progress-bar").css("width",a+"%")},success:function(t){let n=h(t);t.hasOwnProperty("response")&&t.hasOwnProperty("status")&&t.status.code==="ok"&&(n=t.response.images),r(n[0].url),g(i,"success","[[uploads:upload-success]]"),setTimeout(function(){y.hideAlerts(i),i.modal("hide")},750)}})};function h(i){if(typeof i=="string")try{return JSON.parse(i)}catch(r){return console.error(r),{error:"[[error:parse-error]]"}}return i}function v(i,r){return window.FileReader&&r?i.files[0].size<=r*1e3:!0}return y}).apply(E,x),A!==void 0&&(O.exports=A)}),26519:((O,E,f)=>{f.r(E),f.d(E,{start:()=>v});var x=f(17459),A=f.n(x),y=f(33530),C=f.n(y);let g=0,h;function v(r){if(i(),r<=0)return;h||(0,x.translate)("[[login:logged-out-due-to-inactivity]]",function(t){h=t});const e=r*6e4;g=setTimeout(function(){(0,y.alert)({closeButton:!1,message:h,callback:function(){window.location.reload()}})},e)}function i(){g&&clearTimeout(g)}}),54222:((O,E,f)=>{var x,A;x=[f(24187),f(6411),f(91749),f(29930),f(70012),f(89336),f(26519)],A=(function(y,C,g,h,v,i,r){const e={};e.populateTOC=function(){const a=$(".settings-header"),o=$('[component="settings/toc"]'),u=$('[component="settings/toc/list"]'),c=$('[component="settings/main/header"]');if(a.length>1&&u.length){a.each(function(p){const S=$(this),m=S.text(),R=S.parent().attr("id")||`section${p+1}`;R.startsWith("section")&&S.parent().attr("id",R),u.append(`<a class="btn btn-ghost btn-sm text-xs text-start text-decoration-none" href="#${R}">${m}</a>`)});const d=c.outerHeight(!0);u.find("a").on("click",function(p){p.preventDefault();const S=$(this).attr("href");return $(S)[0].scrollIntoView(),window.location.hash=S,scrollBy(0,-d),setTimeout(()=>{u.find("a").removeClass("active"),$(this).addClass("active")},10),!1}),new i.ScrollSpy($("#spy-container")[0],{target:"#settings-navbar",rootMargin:"-10% 0px -70%",smoothScroll:!0});const l=$(`${window.location.hash}`);l.length&&$("html, body").animate({scrollTop:l.offset().top-d+"px"},400),o.removeClass("hidden")}},e.prepare=function(a){const o=$("#content [data-field]"),u=o.length,c=$("#save"),d=$("#revert");let l,p,S,m;o.on("change",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const R=["text","hidden","password","textarea","number"];for(l=0;l<u;l+=1)if(m=o.eq(l),p=m.attr("data-field"),S=m.attr("type"),app.config.hasOwnProperty(p))if(m.is("input")&&S==="checkbox"){const P=parseInt(app.config[p],10)===1;m.prop("checked",P)}else(m.is("textarea")||m.is("select")||m.is("input")&&R.indexOf(S)!==-1)&&m.val(app.config[p]);d.off("click").on("click",function(){ajaxify.refresh()}),c.off("click").on("click",function(P){P.preventDefault(),v.check(document.querySelectorAll("#content [data-field]"))&&s(o,function(T){if(T)return h.alert({alert_id:"config_status",timeout:2500,title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${T.message}]]`,type:"danger"});app.flags._unsaved=!1,e.toggleSaveSuccess(c),g.fire("action:admin.settingsSaved")})}),C.bind("ctrl+s",function(P){c.click(),P.preventDefault()}),t(),n(),$("#clear-sitemap-cache").off("click").on("click",function(){return socket.emit("admin.settings.clearSitemapCache",function(){h.success("Sitemap Cache Cleared!")}),!1}),typeof a=="function"&&a(),setTimeout(function(){g.fire("action:admin.settingsLoaded")},0)},e.toggleSaveSuccess=function(a){const o=a.get(0);o&&(o.classList.toggle("saved",!0),setTimeout(()=>{o.classList.toggle("saved",!1)},1500))};function t(){$('#content input[data-action="upload"]').each(function(){const a=$(this);a.on("click",function(){y.show({title:a.attr("data-title"),description:a.attr("data-description"),route:a.attr("data-route"),params:{},showHelp:a.attr("data-help")?a.attr("data-help")===1:void 0,accept:a.attr("data-accept")},function(o){$("#"+a.attr("data-target")).val(o)})})})}function n(){$('[data-field-type="tagsinput"]').tagsinput({tagClass:"badge bg-info",confirmKeys:[13,44],trimValue:!0}),app.flags._unsaved=!1}e.remove=function(a){socket.emit("admin.config.remove",a)};function s(a,o){const u={};a.each(function(){const c=$(this),d=c.attr("data-field");let l,p;if(c.is("input"))switch(p=c.attr("type"),p){case"text":case"password":case"hidden":case"textarea":case"number":l=c.val();break;case"checkbox":l=c.prop("checked")?"1":"0";break}else(c.is("textarea")||c.is("select"))&&(l=c.val());u[d]=l}),socket.emit("admin.config.setMultiple",u,function(c){if(c)return o(c);for(const[d,l]of Object.entries(u))app.config[d]=l,d==="adminReloginDuration"&&r.start(parseInt(l,10));o()})}return e}).apply(E,x),A!==void 0&&(O.exports=A)}),70012:((O,E,f)=>{var x,A;x=[f(91749),f(29930)],A=(function(y,C){let g=[],h=0;function v(e,t){typeof e!="string"&&(e=$(e),e=e.data("type")||e.attr("type")||e.prop("tagName"));const n=r.plugins[e.toLowerCase()];if(n==null)return;const s=n[t];return typeof s=="function"?s:null}const i={deepClone:function(e){return typeof e=="object"?JSON.parse(JSON.stringify(e)):e},createElement:function(e,t,n){const s=document.createElement(e);for(const[a,o]of Object.entries(t))s.setAttribute(a,o);return n&&s.appendChild(document.createTextNode(n)),s},initElement:function(e){const t=v(e,"init");t?.call(r,$(e))},destructElement:function(e){const t=v(e,"destruct");t?.call(r,$(e))},createElementOfType:function(e,t,n){let s;const a=v(e,"create");return a!=null?s=$(a.call(r,e,t,n)):(n==null&&(n={}),e!=null&&(n.type=e),s=$(i.createElement(t||"input",n))),s.data("type",e),i.initElement(s),s},cleanArray:function(e,t,n){const s=[];if(!t&&n)return e;for(let a=0;a<e.length;a+=1){let o=e[a];t&&(o===!!o?o=+o:o&&typeof o.trim=="function"&&(o=o.trim())),(n||o!=null&&o.length)&&s.push(o)}return s},isTrue:function(e){return e==="true"||+e==1},isFalse:function(e){return e==="false"||+e==0},readValue:function(e){let t=!i.isFalse(e.data("empty"));const n=!i.isFalse(e.data("trim")),s=e.data("split"),a=v(e,"get");let o;if(a!=null)return a.call(r,e,n,t);if(s!=null){t=i.isTrue(e.data("empty")),o=e.val();const u=o!=null&&o.split(s||",")||[];return i.cleanArray(u,n,t)}if(o=e.val(),n&&o!=null&&typeof o.trim=="function"&&(o=o.trim()),t||o!==void 0&&(o==null||o.length!==0))return o},fillField:function(e,t){const n=v(e,"set");let s=e.data("trim");if(s=s!=="false"&&+s!=0,n!=null)return n.call(r,e,t,s);t instanceof Array&&(t=t.join(e.data("split")||(s?", ":","))),s&&t&&typeof t.trim=="function"?(t=t.trim(),typeof t.toString=="function"&&(t=t.toString())):t!=null?(typeof t.toString=="function"&&(t=t.toString()),s&&(t=t.trim())):t="",t!==void 0&&e.val(t)},initFields:function(e){$("[data-key]",e).each(function(t,n){n=$(n);const s=v(n,"init"),a=n.data("key").split(".");let o=r.get();s?.call(r,n);for(let u=0;u<a.length;u+=1){const c=a[u];c&&o!=null&&(o=o[c])}i.fillField(n,o)})},registerReadyJobs:function(e){return h+=e,h},beforeReadyJobsDecreased:function(e){if(e==null&&(e=1),h>0&&(h-=e,h<=0)){for(let t=0;t<g.length;t+=1)g[t]();g=[]}},whenReady:function(e){h<=0?e():g.push(e)},serializeForm:function(e){const t=e.serializeObject();return e.find('input[type="checkbox"]').each(function(n,s){s=$(s),s.is(":checked")||(t[s.attr("name")]="off")}),e.find("select[multiple]").each(function(n,s){s=$(s),t[s.attr("name")]=JSON.stringify(s.val())}),t},persistSettings:function(e,t,n,s){t!=null&&t._!=null&&typeof t._!="string"&&(t=i.deepClone(t),t._=JSON.stringify(t._)),socket.emit("admin.settings.set",{hash:e,values:t},function(a){n&&(a?C.alert({title:"[[admin/admin:changes-not-saved]]",type:"danger",message:`[[admin/admin/changes-not-saved-message, ${a.message}]]`,timeout:5e3}):C.alert({title:"[[admin/admin:changes-saved]]",type:"success",message:"[[admin/admin:changes-saved-message]]",timeout:2500})),typeof s=="function"&&s(a)})},use:function(e){try{e._=JSON.parse(e._)}catch(t){console.error(t)}r.cfg=e}},r={helper:i,plugins:{},cfg:{},get:function(){return r.cfg!=null&&r.cfg._!==void 0?r.cfg._:r.cfg},registerPlugin:function(e,t){t==null?t=e.types:e.types=t,typeof e.use=="function"&&e.use.call(r);for(let n=0;n<t.length;n+=1){const s=t[n].toLowerCase();r.plugins[s]==null&&(r.plugins[s]=e)}},set:function(e,t,n,s,a){a==null&&(a=!0),i.whenReady(function(){i.use(t),i.initFields(n||"form"),i.persistSettings(e,t,a,s)})},sync:function(e,t,n){socket.emit("admin.settings.get",{hash:e},function(s,a){s?typeof n=="function"&&n(s):i.whenReady(function(){i.use(a),i.initFields(t||"form"),typeof n=="function"&&n()})})},persist:function(e,t,n,s){const a=[],o=$("[data-key]",t||"form").toArray();s==null&&(s=!0);for(let u=0;u<o.length;u+=1){const c=$(o[u]),d=i.readValue(c);let l=r.get();const p=c.data("key").split("."),S=p[p.length-1];if(p.length>1)for(let m=0;m<p.length-1;m+=1){const R=p[m];R&&l!=null&&(l=l[R])}l!=null?d!=null?l[S]=d:delete l[S]:a.push(c.data("key"))}a.length&&C.alert({title:"Attributes Not Saved",message:"'"+a.join(", ")+"' could not be saved. Please contact the plugin-author!",type:"danger",timeout:5e3}),i.persistSettings(e,r.cfg,s,n)},load:function(e,t,n){n=n||function(){};const s=t.attr("data-socket-get");socket.emit(s||"admin.settings.get",{hash:e},function(a,o){if(a)return n(a);$(t).find("select[multiple]").each(function(c,d){const l=$(d).attr("name");if(l&&o.hasOwnProperty(l))try{o[l]=JSON.parse(o[l])}catch(p){console.error(p)}}),ajaxify.data[s?e:"settings"]=o,i.whenReady(function(){$(t).find("[data-sorted-list]").each(function(c,d){v(d,"get").call(r,$(d),e)})}),$(t).deserialize(o),y.fire("action:admin.settingsLoaded"),$(t).on("change","input, select, textarea",function(){app.flags=app.flags||{},app.flags._unsaved=!0});const u=document.getElementById("save");u&&f.e(6411).then(function(){var c=[f(6411)];(function(d){d.bind("ctrl+s",function(l){u.click(),l.preventDefault()})}).apply(null,c)}).catch(f.oe),n(null,o)})},save:function(e,t,n){t=$(t);const s=t.get(0).elements;if(r.check(s)&&t.length){const o=i.serializeForm(t);i.whenReady(function(){const c=t.find("[data-sorted-list]");c.length&&c.each((d,l)=>{v(l,"set").call(r,$(l),o)})});const u=t.attr("data-socket-set");socket.emit(u||"admin.settings.set",{hash:e,values:o},function(c){if(app.flags._unsaved=!1,ajaxify.data[u?e:"settings"]=o,typeof n=="function")n(c);else if(c)C.alert({title:"[[admin/admin:changes-not-saved]]",message:`[[admin/admin:changes-not-saved-message, ${c.message}]]`,type:"error",timeout:2500});else{const d=document.getElementById("save");d.classList.toggle("saved",!0),setTimeout(()=>{d.classList.toggle("saved",!1)},1500)}})}},check:function(e){const t=n=>{const s=n.target.closest(".form-group");s&&s.classList.add("has-error"),n.target.removeEventListener("invalid",t)};return Array.prototype.map.call(e,n=>{const s=n.closest(".form-group");return s&&s.classList.remove("has-error"),n.addEventListener("invalid",t),n.reportValidity()}).every(Boolean)}};return i.registerReadyJobs(1),Promise.all([f.e(23662),f.e(65285),f.e(19308)]).then(function(){var e=[f(75210),f(474),f(50397),f(71575),f(40054),f(17708),f(46700),f(59175)];(function(){for(let t=0;t<arguments.length;t+=1)r.registerPlugin(arguments[t]);i.beforeReadyJobsDecreased()}).apply(null,e)}).catch(f.oe),r}).apply(E,x),A!==void 0&&(O.exports=A)})}]);
