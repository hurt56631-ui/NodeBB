"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,13417,15794,25432,26174,34271,34405,49897,53020,78289,95737,99127],{13230:((W,P,c)=>{var b,v,C;(function(k){v=[c(53050)],b=k,C=typeof b=="function"?b.apply(P,v):b,C!==void 0&&(W.exports=C)})(function(k){const L=k("[^\\p{L}\\s\\d\\-_@.]","g"),y=/[^\w\s\d\-_@.]/g,I=/^\s+|\s+$/g,f=/\s+/g,r=/-+/g,F=/-$/g,x=/^-/g,h=/^[\w\d\s.,\-@]+$/;return function(n,i){return n?(n=String(n).replace(I,""),h.test(n)?n=n.replace(y,"-"):n=k.replace(n,L,"-"),n=i?n:n.toLocaleLowerCase(),n=n.replace(f,"-"),n=n.replace(r,"-"),n=n.replace(F,""),n=n.replace(x,""),n):""}})}),29869:(W=>{W.exports=function(P,c,b){c.setGlobal("true",!0),c.setGlobal("false",!1);const v=1440*60*1e3,C={displayMenuItem:L,buildMetaTag:y,buildLinkTag:I,stringify:f,escape:r,stripTags:F,buildCategoryIcon:x,buildCategoryLabel:h,generateCategoryBackground:E,generateChildrenCategories:n,generateTopicClass:i,membershipBtn:o,spawnPrivilegeStates:R,localeToHTML:U,renderTopicImage:A,renderDigestAvatar:T,userAgentIcons:l,buildAvatar:u,increment:N,lessthan:B,greaterthan:j,generateWroteReplied:G,generateRepliedTo:X,generateWrote:V,encodeURIComponent:O,isoTimeToLocaleString:Z,shouldHideReplyContainer:q,humanReadableNumber:a,formattedNumber:s,isNumber:p,txEscape:d,uploadBasename:m,generatePlaceholderWave:w,register:S,__escape:k};function k(e){return e}function L(e,t){const g=e.navigation[t];return!(!g||g.route.match("/users")&&e.user&&!e.user.privileges["view:users"]||g.route.match("/tags")&&e.user&&!e.user.privileges["view:tags"]||g.route.match("/groups")&&e.user&&!e.user.privileges["view:groups"])}function y(e){const t=e.name?'name="'+e.name+'" ':"",g=e.property?'property="'+e.property+'" ':"",D=e.content?'content="'+e.content.replace(/\n/g," ")+'" ':"";return"<meta "+t+g+D+`/>
	`}function I(e){const t=["link","rel","as","type","href","hreflang","sizes","title","crossorigin"],[g,D,K,M,_,Y,H,z,J]=t.map(Q=>e[Q]?`${Q}="${e[Q]}" `:"");return"<link "+g+D+K+M+H+z+_+Y+J+`/>
	`}function f(e){return JSON.stringify(e).replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/g,"&quot;")}function r(e){return P.escapeHTML(e)}function F(e){return P.stripHTMLTags(e)}function x(e,t,g){return e?`<span class="icon d-inline-flex justify-content-center align-items-center align-middle ${g}" style="${E(e)} width:${t}; height: ${t}; font-size: ${parseInt(t,10)/2}px;">${e.icon?`<i class="fa fa-fw ${e.icon}"></i>`:""}</span>`:""}function h(e,t="a",g=""){if(!e)return"";const D=t==="a"?`href="${b}/category/${e.slug}"`:"";return`<${t} component="topic/category" ${D} class="badge px-1 text-truncate text-decoration-none ${g}" style="color: ${e.color};background-color: ${e.bgColor};border-color: ${e.bgColor}!important; max-width: 70vw;">
			${e.icon&&e.icon!=="fa-nbb-none"?`<i class="fa fa-fw ${e.icon}"></i>`:""}
			${e.name}
		</${t}>`}function E(e){if(!e)return"";const t=[];return e.bgColor&&(t.push("background-color: "+e.bgColor),t.push(`border-color: ${e.bgColor}!important`)),e.color&&t.push("color: "+e.color),e.backgroundImage&&(t.push("background-image: url("+e.backgroundImage+")"),e.imageClass&&t.push("background-size: "+e.imageClass)),t.join("; ")+";"}function n(e){let t="";return!e||!e.children||!e.children.length||(e.children.forEach(function(g){if(g&&!g.isSection){const D=g.link?g.link:b+"/category/"+g.slug;t+='<span class="category-children-item float-start"><div role="presentation" class="icon float-start" style="'+E(g)+'"><i class="fa fa-fw '+g.icon+'"></i></div><a href="'+D+'"><small>'+g.name+"</small></a></span>"}}),t=t&&'<span class="category-children">'+t+"</span>"),t}function i(e){return["locked","pinned","deleted","unread","scheduled"].filter(g=>!!e[g]).join(" ")}function o(e,t=""){return e.isMember&&e.name!=="administrators"?`<button class="btn btn-danger ${t}" data-action="leave" data-group="${e.displayName}" ${e.disableLeave?" disabled":""}><i class="fa fa-times"></i> [[groups:membership.leave-group]]</button>`:e.isPending&&e.name!=="administrators"?`<button class="btn btn-warning disabled ${t}"><i class="fa fa-clock-o"></i> [[groups:membership.invitation-pending]]</button>`:e.isInvited?`<button class="btn btn-warning" data-action="rejectInvite" data-group="${e.displayName}">[[groups:membership.reject]]</button><button class="btn btn-success" data-action="acceptInvite" data-group="${e.name}"><i class="fa fa-plus"></i> [[groups:membership.accept-invitation]]</button>`:!e.disableJoinRequests&&e.name!=="administrators"?`<button class="btn btn-success ${t}" data-action="join" data-group="${e.displayName}"><i class="fa fa-plus"></i> [[groups:membership.join-group]]</button>`:""}function R(e,t,g,D){const K=[];for(const[M,_]of Object.entries(g))K.push({name:M,state:_,type:D[M]});return K.map(function(M){const _=["groups:moderate","groups:posts:upvote","groups:posts:downvote","groups:local:login","groups:group:create"],Y=["groups:find","groups:read","groups:topics:read","groups:view:users","groups:view:tags","groups:view:groups"],H=["groups:moderate"];let z=["groups:view:users","groups:find","groups:read","groups:topics:read","groups:topics:create","groups:topics:reply","groups:topics:tag","groups:posts:edit","groups:posts:history","groups:posts:delete","groups:posts:upvote","groups:posts:downvote","groups:topics:delete"];e===-1&&(z=z.slice(3));const J=t==="guests"&&(_.includes(M.name)||M.name.startsWith("groups:admin:"))||t==="spiders"&&!Y.includes(M.name)||t==="fediverse"&&!z.includes(M.name)||t==="Global Moderators"&&H.includes(M.name);return`
				<td data-privilege="${M.name}" data-value="${M.state}" data-type="${M.type}">
					<div class="form-check text-center">
						<input class="form-check-input float-none${J?' d-none"':""}" autocomplete="off" type="checkbox"${M.state?" checked":""}${J?' disabled="disabled" aria-diabled="true"':""} />
					</div>
				</td>
			`}).join("")}function U(e,t){return e=e||t||"en-GB",e.replace("_","-")}function A(e){return e.thumb?'<img src="'+e.thumb+'" class="img-circle user-img" title="'+e.user.displayname+'" />':'<img component="user/picture" data-uid="'+e.user.uid+'" src="'+e.user.picture+'" class="user-img" title="'+e.user.displayname+'" />'}function T(e){return e.teaser?e.teaser.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.teaser.user.picture+'" title="'+e.teaser.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.teaser.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.teaser.user["icon:text"]+"</div>":e.user.picture?'<img style="vertical-align: middle; width: 32px; height: 32px; border-radius: 50%;" src="'+e.user.picture+'" title="'+e.user.username+'" />':'<div style="vertical-align: middle; width: 32px; height: 32px; line-height: 32px; font-size: 16px; background-color: '+e.user["icon:bgColor"]+'; color: white; text-align: center; display: inline-block; border-radius: 50%;">'+e.user["icon:text"]+"</div>"}function l(e){let t="";switch(e.platform){case"Linux":t+='<i class="fa fa-fw fa-linux"></i>';break;case"Microsoft Windows":t+='<i class="fa fa-fw fa-windows"></i>';break;case"Apple Mac":t+='<i class="fa fa-fw fa-apple"></i>';break;case"Android":t+='<i class="fa fa-fw fa-android"></i>';break;case"iPad":t+='<i class="fa fa-fw fa-tablet"></i>';break;case"iPod":case"iPhone":t+='<i class="fa fa-fw fa-mobile"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}switch(e.browser){case"Chrome":t+='<i class="fa fa-fw fa-chrome"></i>';break;case"Firefox":t+='<i class="fa fa-fw fa-firefox"></i>';break;case"Safari":t+='<i class="fa fa-fw fa-safari"></i>';break;case"IE":t+='<i class="fa fa-fw fa-internet-explorer"></i>';break;case"Edge":t+='<i class="fa fa-fw fa-edge"></i>';break;default:t+='<i class="fa fa-fw fa-question-circle"></i>';break}return t}function u(e,t,g,D,K){e||(e=this),D=D||"";const M=new Map([["title",e.displayname],["data-uid",e.uid],["class",`avatar ${D}${g?" avatar-rounded":""}`]]),_=[`--avatar-size: ${t};`],Y=z=>Array.from(z).reduce((J,[Q,ee])=>(J+=` ${Q}="${ee}"`,J),"");let H="";return e.picture&&(H+=`<img${Y(M)} alt="${e.displayname}" loading="lazy" component="${K||"avatar/picture"}" src="${e.picture}" style="${_.join(" ")}" onError="this.remove()" itemprop="image" />`),H+=`<span${Y(M)} component="${K||"avatar/icon"}" style="${_.join(" ")} background-color: ${e["icon:bgColor"]}">${e["icon:text"]}</span>`,H}function N(e,t){return String(e+parseInt(t,10))}function B(e,t){return parseInt(e,10)<parseInt(t,10)}function j(e,t){return parseInt(e,10)>parseInt(t,10)}function G(e,t){return e.toPid?X(e,t):V(e,t)}function X(e,t){const g=e.parent&&e.parent.displayname?e.parent.displayname:"[[global:guest]]";return`[[topic:replied-to-user-${e.timestamp<Date.now()-t*v?"on":"ago"}, ${e.toPid}, ${b}/post/${encodeURIComponent(e.toPid)}, ${g}, ${b}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function V(e,t){return`[[topic:wrote-${e.timestamp<Date.now()-t*v?"on":"ago"}, ${b}/post/${encodeURIComponent(e.pid)}, ${e.timestampISO}]]`}function O(e){return encodeURIComponent(e)}function Z(e,t="en-GB"){return new Date(e).toLocaleString([t],{dateStyle:"short",timeStyle:"short"}).replace(/,/g,"&#44;")}function q(e){return!!(e.replies.count<=0||e.replies.hasSingleImmediateReply)}function a(e,t=1){return P.makeNumberHumanReadable(e,t)}function s(e){return P.addCommas(e)}function p(e){return P.isNumber(e)}function d(e){return String(e).replace(/%/g,"&#37;").replace(/,/g,"&#44;")}function m(e,t="/"){const g=/^\d+-/,D=e.substr(e.lastIndexOf(t)+1);return g.test(D)?D.slice(14):D}function w(e){return e.map(g=>g==="divider"?'<li class="dropdown-divider"></li>':`
			<li class="dropdown-item placeholder-wave">
				<div class="placeholder" style="width: 20px;"></div>
				<div class="placeholder col-${g}"></div>
			</li>`).join("")}function S(){Object.keys(C).forEach(function(e){c.registerHelper(e,C[e])})}return C}}),30076:((W,P,c)=>{var b,v;const C=c(29869);b=[c(77918),c(81335)],v=(function(k,L){return C(k,L,config.relative_path)}).apply(P,b),v!==void 0&&(W.exports=v)}),30637:((W,P,c)=>{var b,v;b=[c(49897),c(81335),c(33530),c(29930)],v=(function(C,k,L,y){const I={};function f(){return ajaxify.data.template.name.startsWith("admin/")}return I.handle=function(){$('[component="user/invite"]').on("click",function(r){r.preventDefault(),C.get(`/api/v3/users/${app.user.uid}/invites/groups`,{}).then(F=>{k.parse("modals/invite",{groups:F},function(x){L.dialog({message:x,title:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,onEscape:!0,buttons:{cancel:{label:`[[${f()?"admin/manage/users:alerts.button-cancel":"modules:bootbox.cancel"}]]`,className:"btn-default"},invite:{label:`[[${f()?"admin/manage/users:invite":"users:invite"}]]`,className:"btn-primary",callback:I.send}}})})}).catch(y.error)})},I.send=function(){const r=$("#invite-modal-emails"),F=$("#invite-modal-groups"),x={emails:r.val().split(",").map(h=>h.trim()).filter(Boolean).filter((h,E,n)=>E===n.indexOf(h)).join(","),groupsToJoin:F.val()};x.emails&&C.post(`/users/${app.user.uid}/invites`,x).then(()=>{y.success(`[[${f()?"admin/manage/users:alerts.email-sent-to":"users:invitation-email-sent"}, ${x.emails.replace(/,/g,"&#44; ")}]]`)}).catch(y.error)},I}).apply(P,b),v!==void 0&&(W.exports=v)}),34405:((W,P,c)=>{var b,v;b=[c(49897),c(29930),c(36e3),c(9787),c(35786)],v=(function(C,k,{Textcomplete:L},{TextareaEditor:y},{ContenteditableEditor:I}){const f={},r={delay:200,appendTo:null};f.init=x=>{const h={...r,...x},{input:E,onSelect:n}=h;app.loadJQueryUI(function(){E.autocomplete({...h,open:function(){$(this).autocomplete("widget").css("z-index",100005)},select:function(i,o){F(E,n,i,o)}})})},f.user=function(x,h,E){typeof h=="function"&&(E=h,h={}),h=h||{},f.init({input:x,onSelect:E,source:(n,i)=>{h.query=n.term,C.get("/api/users",h,function(o,R){if(o)return k.error(o);if(R&&R.users){const U=R.users.map(function(A){const T=$("<div></div>").html(A.username).text();return A&&{label:T,value:T,user:{uid:A.uid,name:A.username,slug:A.userslug,username:A.username,userslug:A.userslug,displayname:A.displayname,picture:A.picture,banned:A.banned,"icon:text":A["icon:text"],"icon:bgColor":A["icon:bgColor"]}}});i(U)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.group=function(x,h){f.init({input:x,onSelect:h,source:(E,n)=>{socket.emit("groups.search",{query:E.term},function(i,o){if(i)return k.error(i);if(o&&o.length){const R=o.map(function(U){return U&&{label:U.name,value:U.name,group:U}});n(R)}$(".ui-autocomplete a").attr("data-ajaxify","false")})}})},f.tag=function(x,h){f.init({input:x,onSelect:h,delay:100,source:(E,n)=>{socket.emit("topics.autocompleteTags",{query:E.term,cid:ajaxify.data.cid||0},function(i,o){if(i)return k.error(i);o&&n(o),$(".ui-autocomplete a").attr("data-ajaxify","false")})}})};function F(x,h,E,n){h=h||function(){};const i=jQuery.Event("keypress");i.which=13,i.keyCode=13,setTimeout(function(){x.trigger(i)},100),h(E,n)}return f.setup=function({element:x,strategies:h,options:E}){const n=x.get(0);if(n){var i;if(n.nodeName==="TEXTAREA"||n.nodeName==="INPUT"?i=new y(n):n.nodeName==="DIV"&&n.getAttribute("contenteditable")==="true"&&(i=new I(n)),!i)throw new Error("unknown target element type");n.setAttribute("dir",document.querySelector("html").getAttribute("data-dir"));var o=new L(i,h,{dropdown:E});return o.on("rendered",function(){o.dropdown.items.length&&o.dropdown.items[0].activate()}),o}},f}).apply(P,b),v!==void 0&&(W.exports=v)}),49897:((W,P,c)=>{c.r(P),c.d(P,{del:()=>E,get:()=>f,head:()=>r,patch:()=>x,post:()=>F,put:()=>h});var b=c(91749),v=c.n(b),C=c(33530),k=c.n(C);const L=config.relative_path+"/api/v3";async function y(n,i){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:L+n.url,typeof i=="function"){I(n).then(o=>i(null,o),o=>i(o));return}try{return await I(n)}catch(o){if(o.message==="A valid login session was not found. Please log in and try again."){const{url:R}=await(0,b.fire)("filter:admin.reauth",{url:"login"});return(0,C.confirm)("[[error:api.reauth-required]]",U=>{U&&ajaxify.go(R)})}throw o}}async function I(n){const{url:i}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,b.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const o=await fetch(i,n),{headers:R}=o;if(R.get("x-redirect"))return I({url:R.get("x-redirect"),...n});const U=R.get("content-type"),A=U&&U.startsWith("application/json");let T;if(n.method!=="HEAD"&&(A?T=await o.json():T=await o.text()),!o.ok)throw T?new Error(A?T.status.message:T):new Error(o.statusText);return A&&T&&T.hasOwnProperty("status")&&T.hasOwnProperty("response")?T.response:T}function f(n,i,o){return y({url:n+(i&&Object.keys(i).length?"?"+$.param(i):"")},o)}function r(n,i,o){return y({url:n+(i&&Object.keys(i).length?"?"+$.param(i):""),method:"HEAD"},o)}function F(n,i,o){return y({url:n,method:"POST",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function x(n,i,o){return y({url:n,method:"PATCH",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function h(n,i,o){return y({url:n,method:"PUT",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}function E(n,i,o){return y({url:n,method:"DELETE",data:i,headers:{"x-csrf-token":config.csrf_token}},o)}}),86296:((W,P,c)=>{var b,v;b=[c(49897),c(33530),c(29930)],v=(function(C,k,L){const y={};return y.init=function(I){const f=k.dialog({message:`
				<label class="form-label">[[admin/manage/users:new-email]]</label>
				<input id="newEmail" class="form-control" type="text" value="${utils.escapeHTML(I.email||"")}">
			`,title:"[[admin/manage/users:change-email]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){const r=f.find("#newEmail").val();return C.post("/users/"+I.uid+"/emails",{skipConfirmation:!0,email:r}).then(()=>{f.modal("hide"),I.onSuccess(r)}).catch(L.error),!1}}}})},y}).apply(P,b),v!==void 0&&(W.exports=v)}),91847:((W,P,c)=>{var b,v;b=[c(17459),c(81335),c(34405),c(49897),c(13230),c(33530),c(29930),c(30637),c(30076),c(86296)],v=(function(C,k,L,y,I,f,r,F,x,h){const E={};E.init=function(){$("#results-per-page").val(ajaxify.data.resultsPerPage).on("change",function(){const a=utils.params();a.resultsPerPage=$("#results-per-page").val();const s=R(a);ajaxify.go(window.location.pathname+"?"+s)}),$(".export-csv").on("click",function(){socket.once("event:export-users-csv",function(){r.remove("export-users-start"),r.alert({alert_id:"export-users",type:"success",title:"[[global:alert.success]]",message:"[[admin/manage/users:export-users-completed]]",clickfn:function(){window.location.href=config.relative_path+"/api/admin/users/csv"},timeout:0})});const s=[{label:"[[admin/manage/users:export-field-email]]",field:"email",selected:!0},{label:"[[admin/manage/users:export-field-username]]",field:"username",selected:!0},{label:"[[admin/manage/users:export-field-uid]]",field:"uid",selected:!0},{label:"[[admin/manage/users:export-field-ip]]",field:"ip",selected:!0},{label:"[[admin/manage/users:export-field-joindate]]",field:"joindate",selected:!1},{label:"[[admin/manage/users:export-field-lastonline]]",field:"lastonline",selected:!1},{label:"[[admin/manage/users:export-field-lastposttime]]",field:"lastposttime",selected:!1},{label:"[[admin/manage/users:export-field-reputation]]",field:"reputation",selected:!1},{label:"[[admin/manage/users:export-field-postcount]]",field:"postcount",selected:!1},{label:"[[admin/manage/users:export-field-topiccount]]",field:"topiccount",selected:!1},{label:"[[admin/manage/users:export-field-profileviews]]",field:"profileviews",selected:!1},{label:"[[admin/manage/users:export-field-followercount]]",field:"followerCount",selected:!1},{label:"[[admin/manage/users:export-field-followingcount]]",field:"followingCount",selected:!1},{label:"[[admin/manage/users:export-field-fullname]]",field:"fullname",selected:!1},{label:"[[admin/manage/users:export-field-birthday]]",field:"birthday",selected:!1},{label:"[[admin/manage/users:export-field-signature]]",field:"signature",selected:!1},{label:"[[admin/manage/users:export-field-aboutme]]",field:"aboutme",selected:!1}].concat(ajaxify.data.customUserFields.map(d=>({label:d.name,field:d.key,selected:!1}))).map((d,m)=>`
				<div class="form-check mb-2">
					<input data-field="${d.field}" class="form-check-input" type="checkbox" id="option-${m}" ${d.selected?"checked":""}>
					<label class="form-check-label" for="option-${m}">
						${d.label}
					</label>
				</div>`).join(""),p=f.dialog({message:s,title:"[[admin/manage/users:export-users-fields-title]]",buttons:{submit:{label:"[[admin/manage/users:export]]",callback:function(){const d=p.find("[data-field]").filter((m,w)=>$(w).is(":checked")).map((m,w)=>$(w).attr("data-field")).get();socket.emit("admin.user.exportUsersCSV",{fields:d},function(m){if(m)return r.error(m);r.alert({alert_id:"export-users-start",message:"[[admin/manage/users:export-users-started]]",timeout:Math.max(5e3,ajaxify.data.userCount/5e3*500)})})}}}});return!1});function l(){const a=[];return $('.users-table [component="user/select/single"]').each(function(){$(this).is(":checked")&&a.push($(this).attr("data-uid"))}),a}function u(a,s){$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(a).each(function(){$(this).toggleClass("hidden",!s)})}function N(){$('.users-table [component="user/select/single"]').prop("checked",!1),$('.users-table [component="user/select/all"]').prop("checked",!1)}function B(a){const s=document.querySelector(`.users-table [component="user/select/single"][data-uid="${a}"]`);if(s){const p=s.closest(".user-row");p.parentNode.removeChild(p)}}function j(a,s,p){return function(d){if(d)return r.error(d);r.success(a),s&&u(s,p),N()}}function G(a,s,p){r.success(a),s&&u(s,p),N()}$('[component="user/select/all"]').on("click",function(){$('.users-table [component="user/select/single"]').prop("checked",$(this).is(":checked"))}),$(".manage-groups").on("click",function(){const a=l();if(!a.length)return r.error("[[error:no-users-selected]]"),!1;socket.emit("admin.user.loadGroups",a,function(s,p){if(s)return r.error(s);k.render("admin/partials/manage_user_groups",p).then(function(d){const m=f.dialog({message:d,title:"[[admin/manage/users:manage-groups]]",onEscape:!0});m.on("shown.bs.modal",function(){L.group(m.find(".group-search"),function(w,S){const e=$(w.target).attr("data-uid");y.put("/groups/"+S.item.group.slug+"/membership/"+e,void 0).then(()=>{S.item.group.nameEscaped=C.escape(S.item.group.displayName),app.parseAndTranslate("admin/partials/manage_user_groups",{users:[{groups:[S.item.group]}]},function(t){$("[data-uid="+e+"] .group-area").append(t.find(".group-area").html())})}).catch(r.error)})}),m.on("click",".group-area a",function(){m.modal("hide")}),m.on("click",".remove-group-icon",function(){const w=$(this).parents("[data-group-name]"),S=w.attr("data-group-name"),e=$(this).parents("[data-uid]").attr("data-uid");return y.del("/groups/"+I(S)+"/membership/"+e).then(()=>{w.remove()}).catch(r.error),!1})})})}),$(".set-reputation").on("click",function(){const a=l();if(!a.length)return r.error("[[error:no-users-selected]]"),!1;let s="";if(a.length===1){const d=ajaxify.data.users.find(m=>m&&m.uid===parseInt(a[0],10));d&&(s=String(d.reputation))}const p=f.dialog({message:`<input id="new-reputation" type="text" class="form-control" value="${s}">`,title:"[[admin/manage/users:set-reputation]]",onEscape:!0,buttons:{submit:{label:"[[global:save]]",callback:function(){const d=p.find("#new-reputation").val();if(!utils.isNumber(d))return r.error("[[error:invalid-data]]"),!1;socket.emit("admin.user.setReputation",{value:d,uids:a}).then(()=>{a.forEach(m=>{$(`[component="user/reputation"][data-uid="${m}"]`).text(x.formattedNumber(d));const w=ajaxify.data.users.find(S=>S&&S.uid===parseInt(m,10));w&&(w.reputation=d)})}).catch(r.error)}}}});p.on("shown.bs.modal",()=>{p.find("#new-reputation").selectRange(0,p.find("#new-reputation").val().length)})}),$(".ban-user").on("click",function(){const a=l();if(!a.length)return r.error("[[error:no-users-selected]]"),!1;f.confirm(a.length>1?"[[admin/manage/users:alerts.confirm-ban-multi]]":"[[admin/manage/users:alerts.confirm-ban]]",function(s){s&&Promise.all(a.map(function(p){return y.put("/users/"+p+"/ban")})).then(()=>{G("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(r.error)})}),$(".ban-user-temporary").on("click",function(){const a=l();if(!a.length)return r.error("[[error:no-users-selected]]"),!1;k.render("modals/temporary-ban",{}).then(function(s){const p=f.dialog({title:"[[user:ban-account]]",message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[admin/manage/users:alerts.button-ban-x, "+a.length+"]]",callback:function(){const d=p.find("form").serializeArray().reduce(function(w,S){return w[S.name]=S.value,w},{}),m=d.length>0?Date.now()+d.length*1e3*60*60*(parseInt(d.unit,10)?24:1):0;Promise.all(a.map(function(w){return y.put("/users/"+w+"/ban",{until:m,reason:d.reason})})).then(()=>{G("[[admin/manage/users:alerts.ban-success]]",".ban",!0)}).catch(r.error)}}}})})}),$(".unban-user").on("click",function(){const a=l();if(!a.length)return r.error("[[error:no-users-selected]]"),!1;k.render("modals/unban",{}).then(function(s){const p=f.dialog({title:"[[user:unban-account]]",message:s,show:!0,onEscape:!0,buttons:{close:{label:"[[global:close]]",className:"btn-link"},submit:{label:"[[user:unban-account]]",callback:function(){const d=p.find("form").serializeArray().reduce(function(m,w){return m[w.name]=w.value,m},{});Promise.all(a.map(function(m){return y.del("/users/"+m+"/ban",{reason:d.reason||""})})).then(()=>{G("[[admin/manage/users:alerts.unban-success]]",".ban",!1)}).catch(r.error)}}}})})}),$(".reset-lockout").on("click",function(){const a=l();a.length&&socket.emit("admin.user.resetLockouts",a,j("[[admin/manage/users:alerts.lockout-reset-success]]"))}),$(".change-email").on("click",function(){const a=l();if(a.length!==1)return r.error("[[admin/manage/users:alerts.select-a-single-user-to-change-email]]");h.init({uid:a[0],onSuccess:function(s){u(".notvalidated",!1),u(".pending",!1),u(".expired",!1),u(".validated",!1),u(".validated-by-admin",!!s),u(".no-email",!s),$('.users-table [component="user/select/single"]:checked').parents(".user-row").find(".validated-by-admin .email").text(s)}})}),$(".validate-email").on("click",function(){const a=l();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-validate-email]]",function(s){s&&socket.emit("admin.user.validateEmail",a,function(p){if(p)return r.error(p);r.success("[[admin/manage/users:alerts.validate-email-success]]"),u(".notvalidated",!1),u(".pending",!1),u(".expired",!1),u(".validated",!1),u(".validated-by-admin",!0),N()})})}),$(".send-validation-email").on("click",function(){const a=l();a.length&&socket.emit("admin.user.sendValidationEmail",a,function(s){if(s)return r.error(s);r.success("[[notifications:email-confirm-sent]]")})}),$(".change-password").on("click",async function(){const a=l();if(!a.length)return;async function s(d){const m=d.find("#newPassword").val(),w=d.find("#confirmPassword").val();if(m!==w)throw new Error("[[[user:change-password-error-match]]");await Promise.all(a.map(S=>y.put("/users/"+S+"/password",{currentPassword:"",newPassword:m})))}const p=f.dialog({message:`<div class="d-flex flex-column gap-2">
					<label class="form-label">[[user:new-password]]</label>
					<input id="newPassword" class="form-control" type="text">
					<label class="form-label">[[user:confirm-password]]</label>
					<input id="confirmPassword" class="form-control" type="text">
				</div>`,title:"[[admin/manage/users:change-password]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},change:{label:"[[admin/manage/users:alerts.button-change]]",className:"btn-primary",callback:function(){return s(p).then(()=>{p.modal("hide")}).catch(r.error),!1}}}})}),$(".password-reset-email").on("click",function(){const a=l();a.length&&f.confirm("[[admin/manage/users:alerts.password-reset-confirm]]",function(s){s&&socket.emit("admin.user.sendPasswordResetEmail",a,j("[[admin/manage/users:alerts.password-reset-email-sent]]"))})}),$(".force-password-reset").on("click",function(){const a=l();a.length&&f.confirm("[[admin/manage/users:alerts.confirm-force-password-reset]]",function(s){s&&socket.emit("admin.user.forcePasswordReset",a,j("[[admin/manage/users:alerts.validate-force-password-reset-success]]"))})}),$(".delete-user").on("click",()=>{O("[[admin/manage/users:alerts.confirm-delete]]","/account")}),$(".delete-user-content").on("click",()=>{O("[[admin/manage/users:alerts.confirm-delete-content]]","/content")}),$(".delete-user-and-content").on("click",()=>{O("[[admin/manage/users:alerts.confirm-purge]]","")});const X=document.querySelector(".users-table"),V=document.getElementById("action-dropdown");X.addEventListener("change",a=>{(a.target.closest('[component="user/select/single"]')||a.target.closest('[component="user/select/all"]'))&&(l().length?V.removeAttribute("disabled"):V.setAttribute("disabled","disabled"))});function O(a,s){const p=l();p.length&&f.confirm(a,function(d){d&&Promise.all(p.map(m=>y.del(`/users/${encodeURIComponent(m)}${s}`,{}).then(()=>{s!=="/content"&&B(m)}))).then(()=>{s!=="/content"?r.success("[[admin/manage/users:alerts.delete-success]]"):r.success("[[admin/manage/users:alerts.delete-content-success]]"),N(),$('.users-table [component="user/select/single"]').length||ajaxify.refresh()}).catch(r.error)})}function Z(){$('[data-action="create"]').on("click",function(){return k.render("admin/partials/create_user_modal",{}).then(function(a){const s=f.dialog({message:a,title:"[[admin/manage/users:alerts.create]]",onEscape:!0,buttons:{cancel:{label:"[[admin/manage/users:alerts.button-cancel]]",className:"btn-link"},create:{label:"[[admin/manage/users:alerts.button-create]]",className:"btn-primary",callback:function(){return q.call(this),!1}}}});s.on("shown.bs.modal",function(){s.find("#create-user-name").focus()})}),!1})}function q(){const a=this,s=document.getElementById("create-user-name").value,p=document.getElementById("create-user-email").value,d=document.getElementById("create-user-password").value,m=document.getElementById("create-user-password-again").value,w=$("#create-modal-error");if(d!==m)return w.translateHtml("[[admin/manage/users:alerts.error-x, [[admin/manage/users:alerts.error-passwords-different]]]]").removeClass("hide");const S={username:s,email:p,password:d};y.post("/users",S).then(()=>{a.modal("hide"),a.on("hidden.bs.modal",function(){ajaxify.refresh()}),r.success("[[admin/manage/users:alerts.create-success]]")}).catch(e=>w.translateHtml("[[admin/manage/users:alerts.error-x, "+e.message+"]]").removeClass("hidden"))}n(),Z(),U(),T(),F.handle()};function n(){function l(){$(".fa-spinner").removeClass("hidden"),i({searchBy:$("#user-search-by").val(),query:$("#user-search").val(),page:1})}$("#user-search").on("keyup",utils.debounce(l,250)),$("#user-search-by").on("change",l)}function i(l){const u=utils.params();u.searchBy=l.searchBy,u.query=l.query,u.page=l.page,u.sortBy=u.sortBy||"lastonline";const N=$.param(u);$.get(config.relative_path+"/api/admin/manage/users?"+N,function(B){o(B);const j=config.relative_path+"/admin/manage/users?"+N;history.pushState&&history.pushState({url:j},null,window.location.protocol+"//"+window.location.host+j)}).fail(function(B){B&&B.responseJSON&&B.responseJSON.error&&r.error(B.responseJSON.error)})}function o(l){k.render("partials/paginator",{pagination:l.pagination}).then(function(u){$(".pagination-container").replaceWith(u)}),app.parseAndTranslate("admin/manage/users","users",l,function(u){if($(".users-table tbody tr").remove(),$(".users-table tbody").append(u),u.find(".timeago").timeago(),$(".fa-spinner").addClass("hidden"),!$("#user-search").val()){$("#user-found-notify").addClass("hidden"),$("#user-notfound-notify").addClass("hidden");return}l&&l.users.length===0?($("#user-notfound-notify").translateHtml("[[admin/manage/users:search.not-found]]").removeClass("hidden"),$("#user-found-notify").addClass("hidden")):($("#user-found-notify").translateHtml(C.compile("admin/manage/users:alerts.x-users-found",l.matchCount,l.timing)).removeClass("hidden"),$("#user-notfound-notify").addClass("hidden"))})}function R(l){return $("#user-search").val()?(l.query=$("#user-search").val(),l.searchBy=$("#user-search-by").val()):(delete l.query,delete l.searchBy),$.param(l)}function U(){$(".users-table thead th").on("click",function(){const u=$(this).attr("data-sort");if(!u)return;const N=utils.params();N.sortBy=u,ajaxify.data.sortBy===u?N.sortDirection=ajaxify.data.reverse?"asc":"desc":N.sortDirection="desc";const B=R(N);ajaxify.go("admin/manage/users?"+B)})}function A(){const l=[];return $("#filter-by").find("[data-filter-by]").each(function(){$(this).find(".fa-check").length&&l.push($(this).attr("data-filter-by"))}),l}function T(){let l=A();$("#filter-by").on("click","li",function(){const u=$(this);return u.find("i").toggleClass("fa-check",!u.find("i").hasClass("fa-check")),!1}),$("#filter-by").on("hidden.bs.dropdown",function(){const u=A();let N=u.length!==l.length;if(u.length===l.length&&u.forEach(function(B,j){B!==l[j]&&(N=!0)}),l=A(),N){const B=utils.params();B.filters=u;const j=R(B);ajaxify.go("admin/manage/users?"+j)}})}return E}).apply(P,b),v!==void 0&&(W.exports=v)})}]);
