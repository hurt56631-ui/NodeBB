(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[1091,34271,34670,36159,49897,58540,62441,88189,98463,99127],{24187:((A,b,o)=>{"use strict";var m,g;m=[o(64061)],g=(function(){const h={};h.show=function(t,r){const a=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:a,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const i=e.find("#uploadForm");i.attr("action",t.route),i.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return v(e,a,r),!1})})},h.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function v(t,r,a){f(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return f(t,"error","[[uploads:select-file-to-upload]]");if(!l(e[0],r))return f(t,"error","[[error:file-too-big, "+r+"]]");h.ajaxSubmit(t,a)}function f(t,r,a){h.hideAlerts(t),r==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),a=a.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+r).translateText(a).removeClass("hide")}h.ajaxSubmit=function(t,r){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=d(e),f(t,"error",e.responseJSON?.status?.message||e.responseJSON?.error||`[[error:upload-error-fallback, ${e.status} ${e.statusText}]]`)},uploadProgress:function(e,i,c,n){t.find("#upload-progress-bar").css("width",n+"%")},success:function(e){let i=d(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(i=e.response.images),r(i[0].url),f(t,"success","[[uploads:upload-success]]"),setTimeout(function(){h.hideAlerts(t),t.modal("hide")},750)}})};function d(t){if(typeof t=="string")try{return JSON.parse(t)}catch(r){return console.error(r),{error:"[[error:parse-error]]"}}return t}function l(t,r){return window.FileReader&&r?t.files[0].size<=r*1e3:!0}return h}).apply(b,m),g!==void 0&&(A.exports=g)}),26940:((A,b,o)=>{A.exports=o(94510)}),36159:((A,b,o)=>{"use strict";var m,g;m=[o(49897),o(33530),o(29930),o(24187),o(81335),o(17459),o(65285)],g=(function(h,v,f,d,l,t){const r={};return r.get=a=>h.get(`/topics/${a}/thumbs`,{thumbsOnly:1}),r.delete=(a,e)=>h.del(`/topics/${a}/thumbs`,{path:e}),r.updateTopicThumbs=async a=>{const e=await r.get(a),i=await app.parseAndTranslate("partials/topic/thumbs",{thumbs:e});$('[component="topic/thumb/list"]').html(i)},r.deleteAll=a=>{r.get(a).then(e=>{Promise.all(e.map(i=>r.delete(a,i.url)))})},r.upload=()=>new Promise(a=>{d.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+"/api/topic/thumb/upload"},function(e){a(e)})}),r.modal={},r.modal.open=function(a){const{id:e,postData:i}=a;let{modal:c}=a;const n=i.thumbs||[];return new Promise(u=>{l.render("modals/topic-thumbs",{thumbs:n}).then(s=>{c?t.translate(s,function(p){c.find(".bootbox-body").html(p),r.modal.handleSort({modal:c,thumbs:n})}):(c=v.dialog({title:"[[modules:thumbs.modal.title]]",message:s,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(r.upload().then(p=>{i.thumbs.push(p.replace(new RegExp(`^${config.upload_url}`),"")),r.modal.open({...a,modal:c}),Promise.all([o.e(20056),o.e(40559),o.e(449),o.e(5785),o.e(52185)]).then(function(){var x=[o(71431)];(D=>{D.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),u()}).apply(null,x)}).catch(o.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),r.modal.handleDelete({...a,modal:c}),r.modal.handleSort({modal:c,thumbs:n}))})})},r.modal.handleDelete=a=>{const e=a.modal.get(0),{id:i}=a;e.addEventListener("click",c=>{c.target.closest('button[data-action="remove"]')&&v.confirm("[[modules:thumbs.modal.confirm-remove]]",n=>{if(!n)return;const u=c.target.closest("[data-path]").getAttribute("data-path"),s=a.postData;s&&s.thumbs&&s.thumbs.includes(u)&&(s.thumbs=s.thumbs.filter(p=>p!==u),r.modal.open(a),Promise.all([o.e(20056),o.e(40559),o.e(449),o.e(5785),o.e(52185)]).then(function(){var p=[o(71431)];(x=>{x.updateThumbCount(i,$(`[component="composer"][data-uuid="${i}"]`))}).apply(null,p)}).catch(o.oe))})})},r.modal.handleSort=({modal:a,thumbs:e})=>{if(e.length>1){const i=a.find(".topic-thumbs-modal");i.sortable({items:"[data-path]"}),i.on("sortupdate",function(){if(!e)return;const c=[];i.find("[data-path]").each(function(){const n=$(this).attr("data-path"),u=e.find(s=>s===n);u&&c.push(u)}),e.length=0,Array.prototype.push.apply(e,c)})}},r}).apply(b,m),g!==void 0&&(A.exports=g)}),49897:((A,b,o)=>{"use strict";o.r(b),o.d(b,{del:()=>c,get:()=>t,head:()=>r,patch:()=>e,post:()=>a,put:()=>i});var m=o(91749),g=o.n(m),h=o(33530),v=o.n(h);const f=config.relative_path+"/api/v3";async function d(n,u){if(n.url=n.url.startsWith("/api")?config.relative_path+n.url:f+n.url,typeof u=="function"){l(n).then(s=>u(null,s),s=>u(s));return}try{return await l(n)}catch(s){if(s.message==="A valid login session was not found. Please log in and try again."){const{url:p}=await(0,m.fire)("filter:admin.reauth",{url:"login"});return(0,h.confirm)("[[error:api.reauth-required]]",x=>{x&&ajaxify.go(p)})}throw s}}async function l(n){const{url:u}=n;delete n.url,n.data&&!(n.data instanceof FormData)&&(n.data=JSON.stringify(n.data||{}),n.headers["content-type"]="application/json; charset=utf-8"),{options:n}=await(0,m.fire)("filter:api.options",{options:n}),n.data&&(n.body=n.data,delete n.data);const s=await fetch(u,n),{headers:p}=s;if(p.get("x-redirect"))return l({url:p.get("x-redirect"),...n});const x=p.get("content-type"),D=x&&x.startsWith("application/json");let E;if(n.method!=="HEAD"&&(D?E=await s.json():E=await s.text()),!s.ok)throw E?new Error(D?E.status.message:E):new Error(s.statusText);return D&&E&&E.hasOwnProperty("status")&&E.hasOwnProperty("response")?E.response:E}function t(n,u,s){return d({url:n+(u&&Object.keys(u).length?"?"+$.param(u):"")},s)}function r(n,u,s){return d({url:n+(u&&Object.keys(u).length?"?"+$.param(u):""),method:"HEAD"},s)}function a(n,u,s){return d({url:n,method:"POST",data:u,headers:{"x-csrf-token":config.csrf_token}},s)}function e(n,u,s){return d({url:n,method:"PATCH",data:u,headers:{"x-csrf-token":config.csrf_token}},s)}function i(n,u,s){return d({url:n,method:"PUT",data:u,headers:{"x-csrf-token":config.csrf_token}},s)}function c(n,u,s){return d({url:n,method:"DELETE",data:u,headers:{"x-csrf-token":config.csrf_token}},s)}}),94510:((A,b,o)=>{"use strict";var m,g;m=[o(89596)],g=(function(h){var v={};return v.insertIntoTextarea=function(f,d){var l={context:this,textarea:f,value:d,preventDefault:!1};if($(window).trigger("action:composer.insertIntoTextarea",l),!l.preventDefault){var t=$(l.textarea),r=t.val(),a=t.parents('[component="composer"]');t.val(r.slice(0,l.textarea.selectionStart)+l.value+r.slice(l.textarea.selectionStart)),h.render(a)}},v.replaceSelectionInTextareaWith=function(f,d){var l={context:this,textarea:f,value:d,preventDefault:!1};if($(window).trigger("action:composer.replaceSelectionInTextareaWith",l),!l.preventDefault){var t=$(l.textarea),r=t.val(),a=t.parents('[component="composer"]');t.val(r.slice(0,l.textarea.selectionStart)+l.value+r.slice(l.textarea.selectionEnd)),h.render(a)}},v.wrapSelectionInTextareaWith=function(f,d,l){var t={context:this,textarea:f,leading:d,trailing:l,preventDefault:!1};if($(window).trigger("action:composer.wrapSelectionInTextareaWith",t),!t.preventDefault){l===void 0&&(l=d);var r=$(f),a=r.val(),e=/^(\s*)([\s\S]*?)(\s*)$/.exec(a.slice(f.selectionStart,f.selectionEnd));return e[2]||(e=[null,"",a.slice(f.selectionStart,f.selectionEnd),""]),r.val(a.slice(0,f.selectionStart)+e[1]+d+e[2]+l+e[3]+a.slice(f.selectionEnd)),[e[1].length,e[3].length]}},v.updateTextareaSelection=function(f,d,l){var t={context:this,textarea:f,start:d,end:l,preventDefault:!1};$(window).trigger("action:composer.updateTextareaSelection",t),!t.preventDefault&&(f.setSelectionRange(t.start,t.end),$(t.textarea).focus())},v.getBlockData=function(f,d,l){var t=f.value;d=d.replace(/[-[\]/{}()*+?.\\^$|]/g,"\\$&");var r=new RegExp(d,"g"),a,e=[],i;for(t=t.split(`
`).reduce(function(c,n){return c!==null||(c=l<=n.length?n:null,c===null&&(l-=n.length+1)),c},null);(a=r.exec(t))!==null;)e.push(a.index);return i={in:!!(e.reduce(function(c,n){return l>=n+2&&(c+=1),c},0)%2),atEnd:e.reduce(function(c,n){return c||l===n},!1)},i.atEnd=i.in?i.atEnd:!1,i},v}).apply(b,m),g!==void 0&&(A.exports=g)})}]);
