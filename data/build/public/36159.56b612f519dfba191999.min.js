"use strict";(self.webpackChunknodebb=self.webpackChunknodebb||[]).push([[36159,58540,98463],{24187:((g,A,n)=>{var h,c;h=[n(64061)],c=(function(){const r={};r.show=function(t,s){const o=t.hasOwnProperty("fileSize")&&t.fileSize!==void 0?parseInt(t.fileSize,10):!1;app.parseAndTranslate("modals/upload-file",{showHelp:t.hasOwnProperty("showHelp")&&t.showHelp!==void 0?t.showHelp:!0,fileSize:o,title:t.title||"[[global:upload-file]]",description:t.description||"",button:t.button||"[[global:upload]]",accept:t.accept?t.accept.replace(/,/g,"&#44; "):""},function(e){e.modal("show"),e.on("hidden.bs.modal",function(){e.remove()});const i=e.find("#uploadForm");i.attr("action",t.route),i.find("#params").val(JSON.stringify(t.params)),e.find("#fileUploadSubmitBtn").on("click",function(){$(this).addClass("disabled"),i.submit()}),i.submit(function(){return p(e,o,s),!1})})},r.hideAlerts=function(t){$(t).find("#alert-status, #alert-success, #alert-error, #upload-progress-box").addClass("hide")};function p(t,s,o){f(t,"status","[[uploads:uploading-file]]"),t.find("#upload-progress-bar").css("width","0%"),t.find("#upload-progress-box").show().removeClass("hide");const e=t.find("#fileInput");if(!e.val())return f(t,"error","[[uploads:select-file-to-upload]]");if(!E(e[0],s))return f(t,"error","[[error:file-too-big, "+s+"]]");r.ajaxSubmit(t,o)}function f(t,s,o){r.hideAlerts(t),s==="error"&&t.find("#fileUploadSubmitBtn").removeClass("disabled"),o=o.replace(/&amp;#44/g,"&#44"),t.find("#alert-"+s).translateText(o).removeClass("hide")}r.ajaxSubmit=function(t,s){t.find("#uploadForm").ajaxSubmit({headers:{"x-csrf-token":config.csrf_token},error:function(e){e=b(e),f(t,"error",e.responseJSON?.status?.message||e.responseJSON?.error||`[[error:upload-error-fallback, ${e.status} ${e.statusText}]]`)},uploadProgress:function(e,i,l,u){t.find("#upload-progress-bar").css("width",u+"%")},success:function(e){let i=b(e);e.hasOwnProperty("response")&&e.hasOwnProperty("status")&&e.status.code==="ok"&&(i=e.response.images),s(i[0].url),f(t,"success","[[uploads:upload-success]]"),setTimeout(function(){r.hideAlerts(t),t.modal("hide")},750)}})};function b(t){if(typeof t=="string")try{return JSON.parse(t)}catch(s){return console.error(s),{error:"[[error:parse-error]]"}}return t}function E(t,s){return window.FileReader&&s?t.files[0].size<=s*1e3:!0}return r}).apply(A,h),c!==void 0&&(g.exports=c)}),36159:((g,A,n)=>{var h,c;h=[n(49897),n(33530),n(29930),n(24187),n(81335),n(17459),n(65285)],c=(function(r,p,f,b,E,t){const s={};return s.get=o=>r.get(`/topics/${o}/thumbs`,{thumbsOnly:1}),s.delete=(o,e)=>r.del(`/topics/${o}/thumbs`,{path:e}),s.updateTopicThumbs=async o=>{const e=await s.get(o),i=await app.parseAndTranslate("partials/topic/thumbs",{thumbs:e});$('[component="topic/thumb/list"]').html(i)},s.deleteAll=o=>{s.get(o).then(e=>{Promise.all(e.map(i=>s.delete(o,i.url)))})},s.upload=()=>new Promise(o=>{b.show({title:"[[topic:composer.thumb-title]]",method:"put",route:config.relative_path+"/api/topic/thumb/upload"},function(e){o(e)})}),s.modal={},s.modal.open=function(o){const{id:e,postData:i}=o;let{modal:l}=o;const u=i.thumbs||[];return new Promise(m=>{E.render("modals/topic-thumbs",{thumbs:u}).then(a=>{l?t.translate(a,function(d){l.find(".bootbox-body").html(d),s.modal.handleSort({modal:l,thumbs:u})}):(l=p.dialog({title:"[[modules:thumbs.modal.title]]",message:a,onEscape:!0,backdrop:!0,buttons:{add:{label:'<i class="fa fa-plus"></i> [[modules:thumbs.modal.add]]',className:"btn-success",callback:()=>(s.upload().then(d=>{i.thumbs.push(d.replace(new RegExp(`^${config.upload_url}`),"")),s.modal.open({...o,modal:l}),Promise.all([n.e(20056),n.e(40559),n.e(449),n.e(5785),n.e(52185)]).then(function(){var S=[n(71431)];(P=>{P.updateThumbCount(e,$(`[component="composer"][data-uuid="${e}"]`)),m()}).apply(null,S)}).catch(n.oe)}),!1)},close:{label:"[[global:close]]",className:"btn-primary"}}}),s.modal.handleDelete({...o,modal:l}),s.modal.handleSort({modal:l,thumbs:u}))})})},s.modal.handleDelete=o=>{const e=o.modal.get(0),{id:i}=o;e.addEventListener("click",l=>{l.target.closest('button[data-action="remove"]')&&p.confirm("[[modules:thumbs.modal.confirm-remove]]",u=>{if(!u)return;const m=l.target.closest("[data-path]").getAttribute("data-path"),a=o.postData;a&&a.thumbs&&a.thumbs.includes(m)&&(a.thumbs=a.thumbs.filter(d=>d!==m),s.modal.open(o),Promise.all([n.e(20056),n.e(40559),n.e(449),n.e(5785),n.e(52185)]).then(function(){var d=[n(71431)];(S=>{S.updateThumbCount(i,$(`[component="composer"][data-uuid="${i}"]`))}).apply(null,d)}).catch(n.oe))})})},s.modal.handleSort=({modal:o,thumbs:e})=>{if(e.length>1){const i=o.find(".topic-thumbs-modal");i.sortable({items:"[data-path]"}),i.on("sortupdate",function(){if(!e)return;const l=[];i.find("[data-path]").each(function(){const u=$(this).attr("data-path"),m=e.find(a=>a===u);m&&l.push(m)}),e.length=0,Array.prototype.push.apply(e,l)})}},s}).apply(A,h),c!==void 0&&(g.exports=c)})}]);
